<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relat√≥rio</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/6582/6582611.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
      min-height: 100vh;
      /*padding: 20px;*/
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-top: 40px;
    }
    
    header {
      background: #f8f9fa;
      color: #333;
      padding: 30px;
      text-align: center;
      position: relative;
      border-bottom: 1px solid #e9ecef;
    }
    
    header h1 {
      margin-top: 15px;
      font-size: 2.2em;
      margin-bottom: 15px;
      font-weight: normal;
    }
    
    header p {
      font-size: 1em;
      margin-bottom: 8px;
      color: #666;
    }
    
    .header-actions {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    
    .btn-export {
      background: #333;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s ease;
    }
    
    .btn-export:hover {
      background: #555;
    }
    
    nav {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    nav a {
      color: #333;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 4px;
      transition: background 0.2s ease;
      border: 1px solid #ddd;
      background: white;
    }
    
    nav a:hover {
      background: #f8f9fa;
    }
    
    main {
      padding: 30px;
    }
    
    section {
      margin-bottom: 40px;
    }
    
    h2 {
      color: #333;
      font-size: 1.5em;
      margin-bottom: 20px;
      padding-bottom: 8px;
      border-bottom: 2px solid #ddd;
    }
    
    .editable {
      border: 1px solid #ddd;
      padding: 15px;
      min-height: 100px;
      border-radius: 4px;
      background: #fafafa;
      transition: border 0.2s ease;
    }
    
    .editable:hover {
      border-color: #999;
    }
    
    .editable:focus {
      outline: none;
      border-color: #333;
      background: white;
    }
    
    .editable p {
      margin-bottom: 12px;
    }
    
    .editable strong {
      color: #333;
    }
    
    .editable ul {
      padding-left: 20px;
    }
    
    .editable li {
      margin-bottom: 6px;
    }
    
    /* Placeholder styles */
    [contenteditable="true"]:empty:before {
      content: attr(data-placeholder);
      color: #999;
      font-style: italic;
      white-space: pre-line;
    }
    
    [contenteditable="true"]:focus:empty:before {
      content: attr(data-placeholder);
      color: #ccc;
      white-space: pre-line;
    }
    
    /* Placeholder for elements with content */
    [contenteditable="true"][data-placeholder]:not(:empty):before {
      display: none;
    }
    
    .template-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 15px;
      border-left: 3px solid #ddd;
    }
    
    .template-section h3 {
      color: #333;
      margin-bottom: 10px;
    }
    
    /* Tipo de relat√≥rio selector */
    .report-type-selector {
      background: #f8f9fa;
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #e9ecef;
    }
    
    .report-type-selector label {
      font-weight: bold;
      margin-right: 20px;
      color: #333;
    }
    
    .report-type-selector select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      font-size: 14px;
      cursor: pointer;
    }
    
    .report-type-selector select:focus {
      outline: none;
      border-color: #333;
    }
    
    /* Seletor de fonte */
    .font-selector {
      position: absolute;
      top: 15px;
      left: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .font-selector label {
      font-size: 12px;
      color: #666;
      font-weight: bold;
    }
    
    .font-selector select {
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      font-size: 12px;
      cursor: pointer;
    }
    
    .font-selector select:focus {
      outline: none;
      border-color: #333;
    }
    
    /* Classes de fonte */
    .font-arial {
      font-family: 'Arial', sans-serif !important;
    }
    
    .font-times {
      font-family: 'Times New Roman', serif !important;
    }
    
    .font-helvetica {
      font-family: 'Helvetica', sans-serif !important;
    }
    
    .font-georgia {
      font-family: 'Georgia', serif !important;
    }
    
    .font-verdana {
      font-family: 'Verdana', sans-serif !important;
    }
    
    .font-courier {
      font-family: 'Courier New', monospace !important;
    }
    
    /* Vers√£o simples */
    .simple-version {
      display: none;
    }
    
    .simple-version .editable {
      min-height: 400px;
      font-size: 16px;
      line-height: 1.8;
      padding: 25px;
    }
    
    .simple-version .editable:focus {
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    
    .simple-version h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
      font-size: 1.8em;
    }
    
    .formatting-toolbar {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    .formatting-toolbar button {
      background: white;
      border: 1px solid #ddd;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s ease;
    }
    
    .formatting-toolbar button:hover {
      background: #f0f0f0;
      border-color: #999;
    }
    
    .formatting-toolbar button.active {
      background: #333;
      color: white;
      border-color: #333;
    }
    
    .word-count {
      margin-left: auto;
      font-size: 12px;
      color: #666;
      font-style: italic;
    }
    
    .word-count-detailed {
      font-size: 12px;
      color: #666;
      font-style: italic;
      margin-bottom: 10px;
      text-align: right;
      padding: 5px 10px;
      background: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #e9ecef;
    }
    
    .simple-version .editable p {
      margin-bottom: 15px;
      text-align: justify;
    }
    
    .simple-version .editable strong {
      font-weight: bold;
    }
    
    .simple-version .editable em {
      font-style: italic;
    }
    
    .simple-version .editable ul, 
    .simple-version .editable ol {
      margin: 15px 0;
      padding-left: 25px;
    }
    
    .simple-version .editable li {
      margin-bottom: 8px;
    }
    
    .simple-version .editable h3 {
      color: #333;
      margin: 25px 0 15px 0;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }
    
    .simple-version .editable h4 {
      color: #555;
      margin: 20px 0 10px 0;
    }
    
    .simple-version .editable blockquote {
      border-left: 4px solid #ddd;
      padding-left: 15px;
      margin: 15px 0;
      font-style: italic;
      color: #666;
    }
    
    /* Bot√£o flutuante de ajuda */
    .help-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: #333;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
      transition: all 0.3s ease;
    }
    
    .help-button:hover {
      background: #555;
      transform: scale(1.1);
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .modal.modal-show {
      opacity: 1;
    }
    
    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 8px;
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }
    
    .modal.modal-show .modal-content {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #eee;
    }
    
    .modal-title {
      font-size: 1.5em;
      font-weight: bold;
      color: #333;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    .modal-body {
      line-height: 1.6;
      color: #333;
    }
    
    .modal-body h3 {
      color: #333;
      margin: 20px 0 10px 0;
      font-size: 1.2em;
    }
    
    .modal-body ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .modal-body li {
      margin-bottom: 8px;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #666;
    }
    
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #333;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    .ia-button{
      position: fixed;
      bottom: 15px;
      left: 15px;
      z-index: 1000;
    }
    .btn-ia{
      background: linear-gradient(135deg, #333 0%, #555 100%);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      padding: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn-ia:hover{
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .btn-ia img{
      width: 32px;
      height: 32px;
      filter: invert(1);
    }
    
    /* Estilos do Modal de IA */
    .modal-ia-content {
      max-width: 700px;
      max-height: 90vh;
    }
    
    .ia-options h3 {
      text-align: center;
      color: #333;
      margin-bottom: 25px;
      font-size: 1.3em;
    }
    
    .ia-option {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }
    
    .ia-option:hover {
      border-color: #333;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .ia-option h4 {
      margin-bottom: 10px;
      color: #333;
      font-size: 1.1em;
    }
    
    .ia-option p {
      color: #666;
      margin-bottom: 15px;
      font-size: 0.9em;
    }
    
    /* Controles de √Åudio */
    .audio-controls {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .btn-record, .btn-play {
      background: #333;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      transition: all 0.3s ease;
      max-width: 200px;
    }
    
    .btn-transcribe {
      background: #28a745;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      transition: all 0.3s ease;
      max-width: 200px;
    }
    
    .btn-record:hover, .btn-play:hover, .btn-transcribe:hover {
      background: #555;
      transform: translateY(-2px);
    }
    
    .btn-transcribe:hover {
      background: #218838;
    }
    
    .btn-record.recording {
      background: #dc3545;
      animation: pulse 1.5s infinite;
    }
    
    .btn-transcribe.transcribing {
      background: #ffc107;
      color: #212529;
      animation: pulse 1.5s infinite;
    }
    
    .btn-play:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-transcribe:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-disabled {
      background: #ccc !important;
      cursor: not-allowed !important;
      opacity: 0.6;
    }
    
    .btn-disabled:hover {
      background: #ccc !important;
      transform: none !important;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .recording-info {
      display: flex;
      align-items: center;
      gap: 15px;
      font-family: monospace;
      font-size: 14px;
      color: #333;
    }
    
    .audio-visualizer {
      display: flex;
      align-items: center;
      gap: 2px;
      height: 30px;
    }
    
    .visualizer-bar {
      width: 3px;
      background: #333;
      border-radius: 2px;
      transition: height 0.1s ease;
    }
    
    /* Textarea para descri√ß√£o */
    #textDescription {
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 12px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      min-height: 100px;
    }
    
    #textDescription:focus {
      outline: none;
      border-color: #333;
      box-shadow: 0 0 0 2px rgba(51,51,51,0.1);
    }
    
    /* Configura√ß√µes */
    .ia-settings {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .ia-settings h4 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .setting-item {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .setting-item label {
      font-weight: bold;
      color: #333;
      font-size: 13px;
    }
    
    .setting-item input,
    .setting-item select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .setting-item input:focus,
    .setting-item select:focus {
      outline: none;
      border-color: #333;
    }
    
    /* Se√ß√£o de Gerar */
    .generate-section {
      text-align: center;
      padding: 20px 0;
    }
    
    .btn-generate {
      background: linear-gradient(135deg, #333 0%, #555 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .btn-generate:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    
    .btn-generate:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-generate.generating {
      background: #28a745;
      animation: generatePulse 2s infinite;
    }
    
    @keyframes generatePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    /* Progresso */
    .generate-progress {
      margin-top: 20px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #333, #555);
      width: 0%;
      transition: width 0.3s ease;
      animation: progressShine 2s infinite;
    }
    
    @keyframes progressShine {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }
    
    #progressText {
      color: #666;
      font-size: 14px;
      margin: 0;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media print {
      body {
        background: white;
        padding: 0;
      }
      .container {
        box-shadow: none;
        border-radius: 0;
      }
      .btn-export, nav {
        display: none;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      header {
        padding: 20px 15px;
      }
      
      header h1 {
        font-size: 1.6em;
        margin-bottom: 12px;
      }
      
      header p {
        font-size: 0.9em;
        margin-bottom: 6px;
      }
      
      .header-actions {
        position: static;
        margin-bottom: 15px;
        text-align: center;
      }
      
      .btn-export {
        width: 100%;
        max-width: 200px;
        padding: 12px 20px;
        font-size: 16px;
        border-radius: 25px;
      }
      
      /* Seletor de fonte mobile melhorado */
      .font-selector {
        position: static;
        margin: 15px 0;
        justify-content: center;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #e9ecef;
      }
      
      .font-selector label {
        font-size: 12px;
        color: #333;
        margin-right: 8px;
      }
      
      .font-selector select {
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        min-width: 120px;
      }
      
      .report-type-selector {
        padding: 12px;
        margin: 15px 0;
      }
      
      .report-type-selector label {
        display: block;
        margin-bottom: 8px;
        margin-right: 0;
        text-align: center;
      }
      
      .report-type-selector select {
        width: 100%;
        max-width: 200px;
        padding: 10px 15px;
        font-size: 16px;
      }
      
      nav {
        flex-direction: column;
        align-items: center;
        gap: 8px;
        margin-top: 15px;
      }
      
      nav a {
        width: 100%;
        max-width: 200px;
        text-align: center;
        padding: 12px 16px;
        font-size: 14px;
      }
      
      main {
        padding: 20px 15px;
      }
      
      section {
        margin-bottom: 30px;
      }
      
      h2 {
        font-size: 1.4em;
        margin-bottom: 15px;
        text-align: center;
      }
      
      .editable {
        padding: 15px;
        min-height: 120px;
        font-size: 16px;
        line-height: 1.6;
      }
      
      /* Vers√£o simples mobile */
      .simple-version .editable {
        min-height: 300px;
        padding: 20px;
        font-size: 16px;
        line-height: 1.7;
      }
      
      .formatting-toolbar {
        flex-wrap: wrap;
        gap: 8px;
        padding: 12px;
        justify-content: center;
      }
      
      .formatting-toolbar button {
        padding: 8px 12px;
        font-size: 14px;
        min-width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .word-count {
        width: 100%;
        text-align: center;
        margin-top: 10px;
        font-size: 14px;
      }
      
      /* Bot√£o de ajuda mobile */
      .help-button {
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        font-size: 24px;
        border-radius: 50%;
      }
      
      /* Modal mobile */
      .modal-content {
        margin: 10% auto;
        padding: 20px;
        width: 95%;
        max-width: none;
        max-height: 85vh;
      }
      
      .modal-header {
        margin-bottom: 15px;
        padding-bottom: 10px;
      }
      
      .modal-title {
        font-size: 1.3em;
      }
      
      .modal-body {
        font-size: 14px;
        line-height: 1.5;
      }
      
      .modal-body h3 {
        font-size: 1.1em;
        margin: 15px 0 8px 0;
      }
      
      .modal-body ul {
        padding-left: 15px;
      }
      
      .modal-body li {
        margin-bottom: 6px;
      }
      
      /* Melhorar espa√ßamento em telas pequenas */
      .template-section {
        padding: 12px;
        margin-bottom: 12px;
      }
      
      .template-section h3 {
        font-size: 1.1em;
        margin-bottom: 8px;
      }
      
      /* Otimizar para telas muito pequenas */
      @media (max-width: 480px) {
        body {
          padding: 5px;
        }
        
        header {
          padding: 15px 10px;
        }
        
        header h1 {
          font-size: 1.4em;
        }
        
        main {
          padding: 15px 10px;
        }
        
        .editable {
          padding: 12px;
          font-size: 15px;
        }
        
        .formatting-toolbar {
          padding: 10px;
        }
        
        .formatting-toolbar button {
          padding: 6px 10px;
          font-size: 13px;
          min-width: 35px;
          height: 35px;
        }
        
        .help-button {
          width: 55px;
          height: 55px;
          font-size: 22px;
        }
        
        /* Seletor de fonte mobile para telas muito pequenas */
        .font-selector {
          margin: 10px 0;
          padding: 8px;
        }
        
        .font-selector label {
          font-size: 11px;
        }
        
        .font-selector select {
          padding: 6px 8px;
          font-size: 12px;
          min-width: 100px;
        }
        
        /* Modal de IA responsivo */
        .modal-ia-content {
          margin: 5% auto;
          width: 95%;
          max-height: 95vh;
        }
        
        .settings-grid {
          grid-template-columns: 1fr;
        }
        
        .audio-controls {
          align-items: center;
        }
        
        .btn-record, .btn-play {
          width: 100%;
          max-width: none;
        }
        
        .btn-transcribe {
          width: 100%;
          max-width: none;
        }
        
        .recording-info {
          justify-content: center;
          flex-wrap: wrap;
        }
        
        .ia-option {
          padding: 15px;
        }
        
        /* API Key responsivo */
        .api-key-setting {
          grid-column: 1 / -1;
        }
        
        .api-key-input-group input {
          font-size: 12px;
          padding: 8px 35px 8px 8px;
        }
        
        .btn-toggle-key {
          right: 3px;
          font-size: 12px;
          padding: 3px;
        }
        
        .api-key-status {
          font-size: 11px;
        }
        
        /* Contadores de palavras responsivos */
        .word-count-detailed {
          font-size: 11px;
          padding: 4px 8px;
          margin-bottom: 8px;
        }
        
        #totalWordCount {
          font-size: 12px;
          margin-bottom: 15px;
        }
        
        /* Footer responsivo */
        .page-footer {
          padding: 12px 15px;
          margin-top: 30px;
        }
        
        .footer-content {
          flex-direction: column;
          text-align: center;
          gap: 10px;
        }
        
        .footer-info-btn {
          padding: 10px 20px;
          font-size: 14px;
        }
        
        /* Modal de informa√ß√µes responsivo */
        .info-modal-content {
          margin: 2% auto;
          width: 95%;
          max-height: 95vh;
        }
        
        .info-section {
          padding: 15px;
          margin-bottom: 20px;
        }
        
        .developer-info {
          flex-direction: column;
          text-align: center;
          gap: 10px;
        }
        
        .developer-avatar {
          width: 50px;
          height: 50px;
        }
        
        .tech-stack {
          justify-content: center;
        }
        
        .version-info {
          flex-direction: column;
          gap: 8px;
        }
      }
    }
    
    /* Estilos para SVGs nos bot√µes */
    .btn-record svg, .btn-play svg, .btn-transcribe svg {
      flex-shrink: 0;
    }
    
    /* Anima√ß√£o para o √≠cone de loading */
    .lucide-loader-2 {
      animation: spin 1s linear infinite;
    }
    
    /* Classe sr-only para acessibilidade */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    /* Sistema de Tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
    }
    
    .tooltip-text {
      visibility: hidden;
      opacity: 0;
      background-color: #333;
      color: white;
      text-align: center;
      border-radius: 6px;
      padding: 8px 12px;
      position: absolute;
      z-index: 1000;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      font-size: 12px;
      font-weight: normal;
      transition: opacity 0.3s, visibility 0.3s;
      pointer-events: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #333 transparent transparent transparent;
    }
    
    .tooltip:hover .tooltip-text,
    .tooltip.active .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    /* Tooltip para mobile - aparece em baixo */
    @media (max-width: 768px) {
      .tooltip-text {
        bottom: auto;
        top: 125%;
        transform: translateX(-50%);
      }
      
      .tooltip-text::after {
        top: auto;
        bottom: 100%;
        border-color: transparent transparent #333 transparent;
      }
    }
    
    /* Varia√ß√µes de cor para diferentes estados */
    .tooltip-success .tooltip-text {
      background-color: #28a745;
    }
    
    .tooltip-success .tooltip-text::after {
      border-color: #28a745 transparent transparent transparent;
    }
    
    .tooltip-error .tooltip-text {
      background-color: #dc3545;
    }
    
    .tooltip-error .tooltip-text::after {
      border-color: #dc3545 transparent transparent transparent;
    }
    
    .tooltip-warning .tooltip-text {
      background-color: #ffc107;
      color: #212529;
    }
    
    .tooltip-warning .tooltip-text::after {
      border-color: #ffc107 transparent transparent transparent;
    }
    
    @media (max-width: 768px) {
      .tooltip-success .tooltip-text::after {
        border-color: transparent transparent #28a745 transparent;
      }
      
      .tooltip-error .tooltip-text::after {
        border-color: transparent transparent #dc3545 transparent;
      }
      
      .tooltip-warning .tooltip-text::after {
        border-color: transparent transparent #ffc107 transparent;
      }
    }
    
    /* Estilos para API Key */
    .api-key-setting {
      grid-column: 1 / -1; /* Ocupar toda a largura */
    }
    
    .api-key-input-group {
      display: flex;
      position: relative;
    }
    
    .api-key-input-group input {
      flex: 1;
      padding-right: 40px;
      font-family: monospace;
      font-size: 13px;
    }
    
    .btn-toggle-key {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      font-size: 14px;
      opacity: 0.6;
      transition: opacity 0.2s ease;
    }
    
    .btn-toggle-key:hover {
      opacity: 1;
    }
    
    .api-key-status {
      margin-top: 5px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .status-empty {
      color: #dc3545;
    }
    
    .status-valid {
      color: #28a745;
    }
    
    .status-invalid {
      color: #ffc107;
    }
    
    .status-icon {
      font-size: 12px;
    }
    
    .api-key-help {
      margin-top: 8px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #007bff;
    }
    
    .api-key-help small {
      color: #666;
      line-height: 1.4;
    }
    
    .api-key-help a {
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
    }
    
    .api-key-help a:hover {
      text-decoration: underline;
    }
    
    /* Footer */
    .page-footer {
      background: white;
      color: #495057;
      padding: 20px;
      margin-top: 40px;
      border-top: 2px solid #f8f9fa;
      box-shadow: 0 -1px 6px rgba(0,0,0,0.08);
    }
    
    .footer-content {
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .footer-content p {
      margin: 0;
      font-size: 14px;
      color: #6c757d;
      font-weight: 500;
    }
    
    .footer-info-btn {
      background: linear-gradient(135deg, #2863a7 0%, #2069c9 100%);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(40, 95, 167, 0.2);
    }
    
    .footer-info-btn:hover {
      background: linear-gradient(135deg, #2069c9 0%, #174fb8 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(40, 95, 167, 0.3);
    }
    
    .footer-info-btn svg {
      flex-shrink: 0;
    }
    
    /* Modal de Informa√ß√µes */
    .info-modal-content {
      max-width: 650px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .info-modal-body {
      padding: 0;
    }
    
    .info-section {
      margin-bottom: 25px;
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .info-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .info-section h3 {
      color: #333;
      margin-bottom: 12px;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-section p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 10px;
    }
    
    .feature-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .feature-list li {
      padding: 8px 0;
      color: #555;
      border-bottom: 1px solid #f5f5f5;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .feature-list li:last-child {
      border-bottom: none;
    }
    
    /* Se√ß√£o do Desenvolvedor */
    .developer-info {
      display: flex;
      align-items: center;
      gap: 15px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }
    
    .developer-avatar {
      background: #007bff;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    
    .developer-details h4 {
      margin: 0 0 5px 0;
      color: #333;
      font-size: 1.1em;
    }
    
    .developer-details p {
      margin: 0 0 5px 0;
      font-size: 14px;
    }
    
    .developer-description {
      font-style: italic;
      color: #777 !important;
    }
    
    /* Se√ß√£o de Agradecimento */
    .gratitude-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-left: 4px solid #28a745;
    }
    
    .gratitude-content p:first-child {
      color: #28a745;
      font-size: 1.1em;
      margin-bottom: 15px;
    }
    
    /* Tecnologias */
    .tech-stack {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .tech-item {
      background: #333;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    /* Vers√£o */
    .version-section {
      background: #333;
      color: white;
      text-align: center;
    }
    
    .version-info {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #ddd;
      padding: 45px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .version-label {
      color: #313131;
      font-size: 14px;
    }
    
    .version-number {
      background: #007bff;
      padding: 4px 12px;
      border-radius: 15px;
      color: #fff;
      font-weight: bold;
      font-size: 14px;
    }
    
    .version-date {
      color: #444444;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-actions">
        <button class="btn-export" onclick="exportToPDF()">
          Exportar PDF
        </button>
      </div>
      
      <div class="font-selector">
        <label for="fontFamily">Fonte:</label>
        <select id="fontFamily" onchange="changeFont()">
          <option value="arial">Arial</option>
          <option value="times">Times New Roman</option>
          <option value="helvetica">Helvetica</option>
          <option value="georgia">Georgia</option>
          <option value="verdana">Verdana</option>
          <option value="courier">Courier New</option>
        </select>
      </div>
      
      <h1 contenteditable="true" data-placeholder="Digite o t√≠tulo do seu relat√≥rio aqui...">T√≠tulo do Relat√≥rio</h1>
      <p contenteditable="true" data-placeholder="Digite o nome do autor..." class="autor">Autor: Nome do Autor</p>
      <p contenteditable="true" data-placeholder="Digite o nome do professor..." class="professor">Professor: Nome do Professor</p>
      <p contenteditable="true" data-placeholder="Digite a data (ex: 15/12/2024)..." class="data">Data:</p>
      
      <div class="report-type-selector">
        <label for="reportType">Tipo de Relat√≥rio:</label>
        <select id="reportType" onchange="changeReportType()">
          <option value="detailed">Detalhado</option>
          <option value="simple">Simples</option>
        </select>
      </div>
      <nav class="nav-detailed">
        <a href="#introducao">Introdu√ß√£o</a>
        <a href="#desenvolvimento">Desenvolvimento</a>
        <a href="#consideracoes">Considera√ß√µes Finais</a>
        <a href="#referencias">Refer√™ncias</a>
      </nav>
      
    </header>
    
    <main>
      <div class = "ia-button">
        <div class="tooltip">
        <button class="btn-ia" onclick="generateReport()">
          <img src="https://img.icons8.com/ios/50/000000/artificial-intelligence.png"/>
        </button>
          <span class="tooltip-text">Gerar relat√≥rio com IA</span>
        </div>
      </div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Gerando PDF...</p>
      </div>
      
      <!-- Vers√£o Detalhada -->
      <div id="detailed-version">
        <div class="word-count-detailed" id="totalWordCount" style="text-align: center; margin-bottom: 20px; font-weight: bold; background: #e7f3ff; border-color: #b3d9ff;">Total: 0 palavras</div>
        
        <section id="introducao">
          <h2>Introdu√ß√£o</h2>
          <div class="word-count-detailed" id="wordCountIntroducao">0 palavras</div>
          <div class="editable" contenteditable="true" data-placeholder="Escreva aqui a introdu√ß√£o do seu relat√≥rio. Comece apresentando o tema, contexto e objetivos do trabalho. Considere incluir: contexto do problema, justificativa, objetivos gerais e espec√≠ficos, e metodologia utilizada.&#10;&#10;Exemplo de estrutura:&#10;‚Ä¢ Contexto do problema ou tema&#10;‚Ä¢ Justificativa para o estudo&#10;‚Ä¢ Objetivos gerais e espec√≠ficos&#10;‚Ä¢ Metodologia utilizada"></div>
        </section>

        <section id="desenvolvimento">
          <h2>Desenvolvimento</h2>
          <div class="word-count-detailed" id="wordCountDesenvolvimento">0 palavras</div>
          
          <div class="editable" contenteditable="true" data-placeholder="Desenvolva aqui o conte√∫do principal do seu relat√≥rio. Estruture em se√ß√µes claras:&#10;&#10;‚Ä¢ Descri√ß√£o do Contexto/Demanda: Detalhe o contexto ou a demanda escolhida, explicando as circunst√¢ncias que motivaram este estudo ou interven√ß√£o.&#10;&#10;‚Ä¢ Objetivos: Defina claramente os objetivos do atendimento, tanto os objetivos gerais quanto os espec√≠ficos.&#10;&#10;‚Ä¢ Possibilidades de Atua√ß√£o: Explore e analise as diferentes possibilidades de atua√ß√£o no caso, considerando alternativas e suas implica√ß√µes.&#10;&#10;‚Ä¢ Estudo de Caso: Apresente um exemplo pr√°tico que ilustre os conceitos discutidos ou demonstre a aplica√ß√£o das metodologias propostas.&#10;&#10;Seja objetivo e use linguagem t√©cnica apropriada."></div>
        </section>

        <section id="consideracoes">
          <h2>Considera√ß√µes Finais</h2>
          <div class="word-count-detailed" id="wordCountConsideracoes">0 palavras</div>
          <div class="editable" contenteditable="true" data-placeholder="Escreva aqui suas considera√ß√µes finais. Reflita sobre os resultados obtidos, aprendizados, limita√ß√µes do estudo e sugest√µes para trabalhos futuros. Esta se√ß√£o deve sintetizar as principais descobertas e conclus√µes do trabalho.&#10;&#10;Considere abordar:&#10;‚Ä¢ Principais descobertas ou conclus√µes&#10;‚Ä¢ Limita√ß√µes do estudo&#10;‚Ä¢ Sugest√µes para trabalhos futuros&#10;‚Ä¢ Impacto e relev√¢ncia dos resultados"></div>
        </section>

        <section id="referencias">
          <h2>Refer√™ncias Bibliogr√°ficas</h2>
          <div class="word-count-detailed" id="wordCountReferencias">0 palavras</div>
          <div class="editable" contenteditable="true" data-placeholder="Liste aqui todas as fontes consultadas seguindo as normas ABNT. Inclua livros, artigos, sites e outras refer√™ncias utilizadas no desenvolvimento do relat√≥rio.&#10;&#10;Exemplos de formata√ß√£o ABNT:&#10;‚Ä¢ SOBRENOME, Nome. T√≠tulo da obra. Edi√ß√£o. Local: Editora, ano.&#10;‚Ä¢ SOBRENOME, Nome. T√≠tulo do artigo. Nome do Peri√≥dico, local, volume(n√∫mero), p√°ginas, m√™s/ano.&#10;‚Ä¢ SOBRENOME, Nome. T√≠tulo do trabalho. Ano. Disserta√ß√£o (Mestrado) ou Tese (Doutorado) - Institui√ß√£o, local, ano."></div>
        </section>
      </div>
      
      <!-- Vers√£o Simples -->
      <div id="simple-version" class="simple-version">
        <section id="conteudo-geral">
          <h2>Conte√∫do do Relat√≥rio</h2>
          
          <div class="formatting-toolbar">
            <div class="word-count" id="wordCount">0 palavras</div>
          </div>
          
          <div class="editable" contenteditable="true" id="simpleContent" data-placeholder="Escreva aqui todo o conte√∫do do seu relat√≥rio de forma livre e organizada.&#10;&#10;Dicas de estrutura√ß√£o:&#10;‚Ä¢ Comece com uma introdu√ß√£o clara&#10;‚Ä¢ Desenvolva o tema principal&#10;‚Ä¢ Apresente an√°lises e discuss√µes&#10;‚Ä¢ Conclua com considera√ß√µes finais&#10;‚Ä¢ Inclua refer√™ncias se necess√°rio&#10;&#10;Use a barra de formata√ß√£o acima para destacar t√≠tulos, listas e cita√ß√µes importantes.&#10;&#10;Organize o texto em par√°grafos bem estruturados e use linguagem clara e objetiva."></div>
        </section>
      </div>
      <div id="modal-ia" class="modal">
        <div class="modal-content modal-ia-content">
          <div class="modal-header">
            <div class="modal-title">Assistente de IA para Relat√≥rios</div>
            <button class="close-modal" onclick="closeIAModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="ia-options">
              <h3>Como voc√™ gostaria de criar seu relat√≥rio?</h3>
              
              <!-- Op√ß√£o de √Åudio -->
              <div class="ia-option audio-option">
                <h4>üé§ Grava√ß√£o de √Åudio</h4>
                <p>Grave um √°udio explicando seu relat√≥rio e a IA criar√° o conte√∫do para voc√™</p>
                <div class="audio-notice" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 12px; color: #856404;">
                  <strong>üí° Dica:</strong> Atualmente, o √°udio √© usado como refer√™ncia. Para melhores resultados, tamb√©m descreva brevemente o conte√∫do no campo de texto abaixo.
          </div>
                <div class="audio-controls">
                  <div class="tooltip">
                    <button id="recordBtn" class="btn-record" onclick="toggleRecording()" aria-label="Iniciar grava√ß√£o">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                           aria-hidden="true" class="lucide lucide-mic">
                        <path d="M12 1v11"></path>
                        <rect x="8" y="1" width="8" height="14" rx="4"></rect>
                        <path d="M19 11a7 7 0 0 1-14 0"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                      </svg>
                      <span class="sr-only">Iniciar Grava√ß√£o</span>
                    </button>
                    <span class="tooltip-text" id="recordTooltip">Clique para iniciar grava√ß√£o</span>
                  </div>
                  
                  <div class="tooltip">
                    <button id="playBtn" class="btn-play" onclick="playRecording()" aria-label="Reproduzir" disabled>
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                           aria-hidden="true" class="lucide lucide-play">
                        <polygon points="6 3 20 12 6 21 6 3"></polygon>
                      </svg>
                      <span class="sr-only">Reproduzir</span>
                    </button>
                    <span class="tooltip-text" id="playTooltip">Reproduzir √°udio gravado</span>
                  </div>
                  
                  <div class="tooltip">
                    <button id="transcribeBtn" class="btn-transcribe" onclick="transcribeAudio()" aria-label="Transcrever √°udio" disabled style="display: none;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                           viewBox="0 0 24 24" fill="none" stroke="currentColor"
                           stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                           aria-hidden="true" class="lucide lucide-file-text">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2-2V7.5z"></path>
                        <path d="M14 2v6h6"></path>
                        <path d="M16 13H8"></path>
                        <path d="M16 17H8"></path>
                        <path d="M10 9H8"></path>
                      </svg>
                      <span class="sr-only">Transcrever √Åudio</span>
                    </button>
                    <span class="tooltip-text" id="transcribeTooltip">Converter √°udio em texto</span>
                  </div>
                  
                  <div class="recording-info">
                    <span id="recordingTime">00:00</span>
                    <div class="audio-visualizer" id="audioVisualizer"></div>
                  </div>
                </div>
                <audio id="audioPlayback" controls style="display: none;"></audio>
                <!-- √Årea para mostrar transcri√ß√£o -->
                <div id="transcriptionArea" style="display: none; margin-top: 15px;">
                  <h5 style="color: #333; margin-bottom: 10px;">üìù Transcri√ß√£o do √Åudio:</h5>
                  <div id="transcriptionText" style="background: #f8f9fa; border: 1px solid #ddd; padding: 12px; border-radius: 4px; font-size: 14px; line-height: 1.5; max-height: 150px; overflow-y: auto;"></div>
                  <div style="margin-top: 8px; font-size: 12px; color: #666;">
                    <em>A transcri√ß√£o ser√° combinada com sua descri√ß√£o em texto para gerar o relat√≥rio.</em>
                  </div>
                </div>
              </div>

              <!-- Op√ß√£o de Texto -->
              <div class="ia-option text-option">
                <h4>‚úçÔ∏è Descri√ß√£o por Texto</h4>
                <p>Descreva brevemente o que voc√™ quer no relat√≥rio</p>
                <textarea id="textDescription" placeholder="Ex: Quero um relat√≥rio sobre sustentabilidade empresarial, incluindo conceitos b√°sicos, benef√≠cios, desafios e exemplos pr√°ticos..." rows="4"></textarea>
              </div>

              <!-- Configura√ß√µes -->
              <div class="ia-settings">
                <h4>‚öôÔ∏è Configura√ß√µes do Relat√≥rio</h4>
                <div class="settings-grid">
                  <div class="setting-item api-key-setting">
                    <label for="geminiApiKey">üîë Chave API Gemini:</label>
                    <div class="api-key-input-group">
                      <input type="password" id="geminiApiKey" placeholder="Cole sua chave API aqui..." maxlength="100">
                      <button type="button" id="toggleApiKey" class="btn-toggle-key" onclick="toggleApiKeyVisibility()" title="Mostrar/Ocultar chave">
                        üëÅÔ∏è
                      </button>
                    </div>
                    <div class="api-key-status" id="apiKeyStatus">
                      <span class="status-empty">Nenhuma chave configurada</span>
                    </div>
                    <div class="api-key-help">
                      <small>
                        üí° <strong>Como obter sua chave:</strong> 
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">
                          Clique aqui para obter uma chave gratuita do Google AI Studio
                        </a>
                      </small>
                    </div>
                  </div>
                  <div class="setting-item">
                    <label for="reportTopic">Tema Principal:</label>
                    <input type="text" id="reportTopic" placeholder="Ex: Sustentabilidade Empresarial">
                  </div>
                  <div class="setting-item">
                    <label for="reportLength">Tamanho:</label>
                    <select id="reportLength">
                      <option value="short">Curto (2-3 p√°ginas)</option>
                      <option value="medium" selected>M√©dio (4-6 p√°ginas)</option>
                      <option value="long">Longo (7-10 p√°ginas)</option>
                    </select>
                  </div>
                  <div class="setting-item">
                    <label for="academicLevel">N√≠vel Acad√™mico:</label>
                    <select id="academicLevel">
                      <option value="ensino-medio">Ensino M√©dio</option>
                      <option value="graduacao" selected>Gradua√ß√£o</option>
                      <option value="pos-graduacao">P√≥s-gradua√ß√£o</option>
                    </select>
                  </div>
                  <div class="setting-item">
                    <label for="reportStyle">Estilo:</label>
                    <select id="reportStyle">
                      <option value="formal" selected>Formal/Acad√™mico</option>
                      <option value="tecnico">T√©cnico</option>
                      <option value="didatico">Did√°tico</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Bot√£o de Gerar -->
              <div class="generate-section">
                <div class="tooltip">
                  <button id="generateBtn" class="btn-generate" onclick="generateReportWithIA()">
                    <span id="generateIcon">ü§ñ</span>
                    <span id="generateText">Gerar Relat√≥rio com IA</span>
                  </button>
                  <span class="tooltip-text" id="generateTooltip">Processar conte√∫do e gerar relat√≥rio automaticamente</span>
                </div>
                <div class="generate-progress" id="generateProgress" style="display: none;">
                  <div class="progress-bar">
                    <div class="progress-fill"></div>
                  </div>
                  <p id="progressText">Analisando conte√∫do...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer class="page-footer">
    <div class="footer-content">
      <p>&copy; 2025 Sistema de Relat√≥rios com IA</p>
      <button class="footer-info-btn" id="footerInfoBtn" type="button" onclick="showInfoModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        Sobre
      </button>
    </div>
  </footer>

  <!-- Bot√£o flutuante de ajuda -->
  <!--<button class="help-button" id="helpButton" onclick="showHelpModal()">!</button>-->

  <!-- Modal de ajuda -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Dicas de Preenchimento</div>
        <button class="close-modal" onclick="closeHelpModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Conte√∫do ser√° preenchido dinamicamente -->
      </div>
    </div>
  </div>

  <!-- Modal de Informa√ß√µes -->
  <div class="modal" id="infoModal">
    <div class="modal-content info-modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               style="margin-right: 8px; color: #007bff;">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          Sobre o Sistema
        </div>
        <button class="close-modal" onclick="closeInfoModal()">&times;</button>
      </div>
      <div class="modal-body info-modal-body">
        <div class="info-section">
          <h3>ü§ñ Sistema de Relat√≥rios com IA</h3>
          <p>Uma ferramenta moderna e intuitiva para cria√ß√£o de relat√≥rios acad√™micos e profissionais com o poder da Intelig√™ncia Artificial.</p>
        </div>

        <div class="info-section">
          <h3>‚ú® Principais Funcionalidades</h3>
          <ul class="feature-list">
            <li>üìù Editor inteligente com duas vers√µes (Detalhada e Simples)</li>
            <li>üé§ Grava√ß√£o e transcri√ß√£o de √°udio com IA</li>
            <li>ü§ñ Gera√ß√£o autom√°tica de conte√∫do com Google Gemini</li>
            <li>üìÑ Exporta√ß√£o para PDF profissional</li>
            <li>üíæ Salvamento autom√°tico no navegador</li>
            <li>üì± Interface responsiva para mobile e desktop</li>
            <li>üé® M√∫ltiplas fontes e estilos de formata√ß√£o</li>
          </ul>
        </div>

        <div class="info-section">
          <h3>üë®‚Äçüíª Desenvolvido por</h3>
          <div class="developer-info">
            <div class="developer-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor"
                   stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </div>
            <div class="developer-details">
              <h4>Giuseph De Luka Giangareli</h4>
              <p>Desenvolvedor Full Stack</p>
              <p class="developer-description">
                Especialista em desenvolvimento web moderno, intelig√™ncia artificial e experi√™ncia do usu√°rio.
              </p>
            </div>
          </div>
        </div>

        <div class="info-section gratitude-section">
          <h3>üôè Agradecimento</h3>
          <div class="gratitude-content">
            <p><strong>Obrigado por usar nosso sistema!</strong></p>
            <p>Sua confian√ßa em nossa ferramenta nos motiva a continuar inovando e melhorando constantemente. 
               Esperamos que este sistema torne seu trabalho mais eficiente e produtivo.</p>
            <p>Se voc√™ tem sugest√µes ou feedback, ficaremos muito felizes em ouvir!</p>
          </div>
        </div>

        <div class="page-footer">
          <div class="version-info">
            <span class="version-label">Vers√£o:</span>
            <span class="version-number">2.0.6</span>
            <span class="version-date">Agosto 2025</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Fun√ß√£o para exportar como PDF
    async function exportToPDF() {
      const loading = document.getElementById('loading');
      const btnExport = document.querySelector('.btn-export');
      
      // Mostrar loading
      loading.style.display = 'block';
      btnExport.disabled = true;
      btnExport.textContent = 'Gerando...';
      
      try {
        // Ocultar elementos que n√£o devem aparecer no PDF
        const headerActions = document.querySelector('.header-actions');
        const nav = document.querySelector('nav');
        const reportTypeSelector = document.querySelector('.report-type-selector');
        const helpButton = document.getElementById('helpButton');
        headerActions.style.display = 'none';
        nav.style.display = 'none';
        reportTypeSelector.style.display = 'none';
        if (helpButton) helpButton.style.display = 'none';
        
        // Criar PDF com layout organizado
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        // Obter a fonte selecionada
        const selectedFont = document.getElementById('fontFamily').value;
        let pdfFont = 'helvetica'; // Fonte padr√£o do jsPDF
        
        // Mapear fontes para as dispon√≠veis no jsPDF
        const fontMapping = {
          'arial': 'helvetica',
          'times': 'times',
          'helvetica': 'helvetica',
          'georgia': 'times', // Georgia n√£o dispon√≠vel, usar Times
          'verdana': 'helvetica', // Verdana n√£o dispon√≠vel, usar Helvetica
          'courier': 'courier'
        };
        
        pdfFont = fontMapping[selectedFont] || 'helvetica';
        
        // Configura√ß√µes de p√°gina
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const margin = 20;
        const contentWidth = pageWidth - (2 * margin);
        
        // Obter dados do relat√≥rio
        const titleElement = document.querySelector('h1');
        let title = titleElement ? titleElement.textContent.trim() : '';
        
        // Validar t√≠tulo
        if (!title || title === 'T√≠tulo do Relat√≥rio') {
          title = 'Relat√≥rio Acad√™mico';
        }
        
        // Limitar tamanho m√°ximo do t√≠tulo para evitar problemas de layout
        if (title.length > 120) {
          title = title.substring(0, 117) + '...';
        }
        
        const author = 'Autor: ' + document.querySelector('.autor').textContent.replace('Autor: ', '') || 'Nome do Autor';
        const professor = 'Professor: ' + document.querySelector('.professor').textContent.replace('Professor: ', '') || 'Nome do Professor';
        const currentDate = new Date().toLocaleDateString('pt-BR');
        
        let yPosition = margin;
        
        // Primeira p√°gina - Cabe√ßalho
        // T√≠tulo no topo com quebra de linha para t√≠tulos longos
        pdf.setFontSize(18);
        pdf.setFont(pdfFont, 'bold');
        
        // Quebrar t√≠tulo em linhas se for muito longo
        const maxTitleWidth = contentWidth - 40; // Deixar margem extra para o t√≠tulo
        const titleLines = pdf.splitTextToSize(title, maxTitleWidth);
        
        // Limitar n√∫mero m√°ximo de linhas do t√≠tulo
        const maxTitleLines = 3;
        let finalTitleLines = titleLines;
        
        if (titleLines.length > maxTitleLines) {
          // Se o t√≠tulo tem muitas linhas, truncar e adicionar "..."
          finalTitleLines = titleLines.slice(0, maxTitleLines - 1);
          const lastLine = titleLines[maxTitleLines - 1];
          const truncatedLastLine = lastLine.length > 50 ? lastLine.substring(0, 47) + '...' : lastLine + '...';
          finalTitleLines.push(truncatedLastLine);
        }
        
        // Calcular altura total do t√≠tulo
        const lineHeight = 8; // Altura entre linhas
        const titleHeight = finalTitleLines.length * lineHeight;
        
        // Adicionar cada linha do t√≠tulo
        finalTitleLines.forEach((line, index) => {
          pdf.text(line, pageWidth / 2, yPosition + (index * lineHeight), { align: 'center' });
        });
        
        // Ajustar posi√ß√£o Y baseada no n√∫mero de linhas do t√≠tulo
        yPosition += titleHeight + 20; // Espa√ßo extra ap√≥s o t√≠tulo
        
        // Autor e Professor no centro da p√°gina (ajustado para t√≠tulos grandes)
        let centerY = pageHeight / 2;
        
        // Se o t√≠tulo for muito grande, ajustar o centro para baixo
        const titleEndPosition = margin + titleHeight + 20;
        if (titleEndPosition > 80) {
          centerY = Math.max(centerY, titleEndPosition + 60);
        }
        
        // Garantir que autor e professor n√£o fiquem muito pr√≥ximos da data
        const minDistanceFromBottom = 80;
        centerY = Math.min(centerY, pageHeight - minDistanceFromBottom);
        
        pdf.setFontSize(12);
        pdf.setFont(pdfFont, 'normal');
        pdf.text(author, pageWidth / 2, centerY - 10, { align: 'center' });
        pdf.text(professor, pageWidth / 2, centerY + 10, { align: 'center' });
        
        // Data no final da primeira p√°gina
        pdf.setFontSize(10);
        pdf.setFont(pdfFont, 'normal');
        pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
        
        // Conte√∫do baseado no tipo de relat√≥rio - COME√áA NA SEGUNDA P√ÅGINA
        const reportType = document.getElementById('reportType').value;
        
        if (reportType === 'detailed') {
          // Vers√£o detalhada
          const sections = [
            { id: 'introducao', title: 'Introdu√ß√£o' },
            { id: 'desenvolvimento', title: 'Desenvolvimento' },
            { id: 'consideracoes', title: 'Considera√ß√µes Finais' },
            { id: 'referencias', title: 'Refer√™ncias Bibliogr√°ficas' }
          ];
          
          for (let i = 0; i < sections.length; i++) {
            const section = sections[i];
            const sectionElement = document.getElementById(section.id);
            
            if (sectionElement) {
              const content = sectionElement.querySelector('.editable').textContent.trim();
              
              if (content) {
                // Sempre come√ßar na segunda p√°gina para o primeiro conte√∫do
                if (i === 0) {
                  pdf.addPage();
                  yPosition = margin;
                  // Data no final de cada p√°gina
                  pdf.setFontSize(10);
                  pdf.setFont(pdfFont, 'normal');
                  pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
                } else {
                  // Verificar se precisa de nova p√°gina para se√ß√µes subsequentes
                  if (yPosition > pageHeight - 60) {
                    pdf.addPage();
                    yPosition = margin;
                    // Data no final de cada p√°gina
                    pdf.setFontSize(10);
                    pdf.setFont(pdfFont, 'normal');
                    pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
                  }
                }
                
                // T√≠tulo da se√ß√£o com quebra de linha se necess√°rio
                pdf.setFontSize(14);
                pdf.setFont(pdfFont, 'bold');
                
                // Quebrar t√≠tulo da se√ß√£o se for muito longo
                const sectionTitleLines = pdf.splitTextToSize(section.title, contentWidth);
                sectionTitleLines.forEach((line, index) => {
                  pdf.text(line, margin, yPosition + (index * 6));
                });
                
                yPosition += (sectionTitleLines.length * 6) + 9; // Ajustar espa√ßo baseado no n√∫mero de linhas
                
                // Conte√∫do da se√ß√£o
                pdf.setFontSize(11);
                pdf.setFont(pdfFont, 'normal');
                
                // Quebrar texto em linhas
                const lines = pdf.splitTextToSize(content, contentWidth);
                
                for (let j = 0; j < lines.length; j++) {
                  // Verificar se precisa de nova p√°gina
                  if (yPosition > pageHeight - 40) {
                    pdf.addPage();
                    yPosition = margin;
                    // Data no final de cada p√°gina
                    pdf.setFontSize(10);
                    pdf.setFont(pdfFont, 'normal');
                    pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
                  }
                  
                  pdf.text(lines[j], margin, yPosition);
                  yPosition += 6;
                }
                
                yPosition += 10; // Espa√ßo entre se√ß√µes
              }
            }
          }
        } else {
          // Vers√£o simples - COME√áA NA SEGUNDA P√ÅGINA
          const simpleContent = document.getElementById('simpleContent');
          if (simpleContent) {
            const content = simpleContent.textContent.trim();
            
            if (content) {
              // Sempre come√ßar na segunda p√°gina
              pdf.addPage();
              yPosition = margin;
              // Data no final de cada p√°gina
              pdf.setFontSize(10);
              pdf.setFont(pdfFont, 'normal');
              pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
              
              // T√≠tulo da se√ß√£o com quebra de linha se necess√°rio
              pdf.setFontSize(14);
              pdf.setFont(pdfFont, 'bold');
              
              // Quebrar t√≠tulo se for muito longo
              const simpleTitleLines = pdf.splitTextToSize('Conte√∫do do Relat√≥rio', contentWidth);
              simpleTitleLines.forEach((line, index) => {
                pdf.text(line, margin, yPosition + (index * 6));
              });
              
              yPosition += (simpleTitleLines.length * 6) + 9;
              
              // Conte√∫do
              pdf.setFontSize(11);
              pdf.setFont(pdfFont, 'normal');
              
              // Quebrar texto em linhas
              const lines = pdf.splitTextToSize(content, contentWidth);
              
              for (let j = 0; j < lines.length; j++) {
                // Verificar se precisa de nova p√°gina
                if (yPosition > pageHeight - 40) {
                  pdf.addPage();
                  yPosition = margin;
                  // Data no final de cada p√°gina
                  pdf.setFontSize(10);
                  pdf.setFont(pdfFont, 'normal');
                  pdf.text(currentDate, pageWidth / 2, pageHeight - margin, { align: 'center' });
                }
                
                pdf.text(lines[j], margin, yPosition);
                yPosition += 6;
              }
            }
          }
        }
        
        // Salvar PDF
        const fileName = `${title.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
        pdf.save(fileName);
        
      } catch (error) {
        console.error('Erro ao gerar PDF:', error);
        alert('Erro ao gerar PDF. Tente novamente.');
      } finally {
        // Restaurar elementos
        const headerActions = document.querySelector('.header-actions');
        const nav = document.querySelector('nav');
        const reportTypeSelector = document.querySelector('.report-type-selector');
        const helpButton = document.getElementById('helpButton');
        headerActions.style.display = 'block';
        nav.style.display = 'flex';
        reportTypeSelector.style.display = 'block';
        if (helpButton) helpButton.style.display = 'block';
        
        // Ocultar loading
        loading.style.display = 'none';
        btnExport.disabled = false;
        btnExport.textContent = 'Exportar PDF';
      }
    }
    
    // Fun√ß√£o para mudar o tipo de relat√≥rio
    function changeReportType() {
      const reportType = document.getElementById('reportType').value;
      const detailedVersion = document.getElementById('detailed-version');
      const simpleVersion = document.getElementById('simple-version');
      const navDetailed = document.querySelector('.nav-detailed');
      
      if (reportType === 'detailed') {
        detailedVersion.style.display = 'block';
        simpleVersion.style.display = 'none';
        navDetailed.style.display = 'block';
        
        // Atualizar contadores da vers√£o detalhada
        setTimeout(() => {
          updateDetailedWordCounts();
        }, 100);
      } else {
        detailedVersion.style.display = 'none';
        simpleVersion.style.display = 'block';
        navDetailed.style.display = 'none';
        
        // Atualizar contador da vers√£o simples
        setTimeout(() => {
          updateWordCount();
        }, 100);
      }
    }
    
    // Fun√ß√µes de formata√ß√£o para a vers√£o simples
    function formatText(command) {
      document.execCommand(command, false, null);
      updateWordCount();
    }

    function insertHeading(level) {
      const selection = document.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const newElement = document.createElement(level);
        newElement.textContent = 'T√≠tulo ' + level.toUpperCase();
        range.insertNode(newElement);
        range.setStartAfter(newElement);
        range.collapse(true);
        selection.removeAllRanges();
        selection.addRange(range);
        updateWordCount();
      }
    }

    function insertList(type) {
      const selection = document.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const list = document.createElement(type);
        const li = document.createElement('li');
        li.textContent = 'Item da lista';
        list.appendChild(li);
        range.insertNode(list);
        updateWordCount();
      }
    }

    function insertBlockquote() {
      const selection = document.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const blockquote = document.createElement('blockquote');
        blockquote.textContent = 'Sua cita√ß√£o aqui...';
        range.insertNode(blockquote);
        updateWordCount();
      }
    }

    function insertTemplate() {
      const template = `
        <h3>Introdu√ß√£o</h3>
        <p>Aqui voc√™ pode escrever a introdu√ß√£o do seu relat√≥rio. Comece apresentando o tema, contexto e objetivos do trabalho.</p>
        
        <h3>Desenvolvimento</h3>
        <p>Aqui voc√™ pode escrever o conte√∫do principal do seu relat√≥rio. Estruture em se√ß√µes claras e seja objetivo.</p>
        
        <h3>Considera√ß√µes Finais</h3>
        <p>Aqui voc√™ pode escrever suas considera√ß√µes finais. Reflita sobre os resultados obtidos e aprendizados.</p>
        
        <h3>Refer√™ncias Bibliogr√°ficas</h3>
        <p>Liste aqui todas as fontes consultadas seguindo as normas ABNT.</p>
      `;
      const selection = document.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const newDiv = document.createElement('div');
        newDiv.innerHTML = template;
        range.insertNode(newDiv);
        updateWordCount();
      }
    }

    function updateWordCount() {
      const editable = document.getElementById('simpleContent');
      if (editable) {
        const text = editable.textContent;
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        const wordCountElement = document.getElementById('wordCount');
        if (wordCountElement) {
          wordCountElement.textContent = `${words.length} palavras`;
        }
      }
    }
    
    // Fun√ß√£o para atualizar contadores de palavras da vers√£o detalhada
    function updateDetailedWordCounts() {
      const sections = ['introducao', 'desenvolvimento', 'consideracoes', 'referencias'];
      let totalWords = 0;
      
      sections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const editable = section.querySelector('.editable');
          const wordCountElement = document.getElementById(`wordCount${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`);
          
          if (editable && wordCountElement) {
            const text = editable.textContent || editable.innerText || '';
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const wordCount = words.length;
            totalWords += wordCount;
            
            wordCountElement.textContent = `${wordCount} palavras`;
          }
        }
      });
      
      // Atualizar contador total se existir
      const totalCountElement = document.getElementById('totalWordCount');
      if (totalCountElement) {
        totalCountElement.textContent = `Total: ${totalWords} palavras`;
      }
    }
    
    // Vari√°veis globais para o sistema de ajuda
    let currentHelpContent = '';
    let helpButtonVisible = false;
    
    // Fun√ß√£o para mostrar o modal de ajuda
    function showHelpModal() {
      const modal = document.getElementById('helpModal');
      const modalBody = document.getElementById('modalBody');
      modalBody.innerHTML = currentHelpContent;
      modal.style.display = 'block';
      
      setTimeout(() => {
        modal.classList.add('modal-show');
      }, 10);
    }
    
    // Fun√ß√£o para fechar o modal de ajuda
    function closeHelpModal() {
      const modal = document.getElementById('helpModal');
      modal.classList.remove('modal-show');
      
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }
    
    // Fun√ß√£o para mostrar/esconder o bot√£o de ajuda
    function toggleHelpButton(show) {
      const helpButton = document.getElementById('helpButton');
      if (show && !helpButtonVisible) {
        helpButton.style.display = 'block';
        helpButtonVisible = true;
      } else if (!show && helpButtonVisible) {
        helpButton.style.display = 'none';
        helpButtonVisible = false;
      }
    }
    
    // Fun√ß√£o para definir o conte√∫do de ajuda baseado no campo ativo
    function setHelpContent(fieldId) {
      const helpContents = {
        'introducao': `
          <h3>Como escrever uma boa Introdu√ß√£o:</h3>
          <p>A introdu√ß√£o deve contextualizar o leitor sobre o assunto abordado e estabelecer a relev√¢ncia do trabalho.</p>
          
          <h3>Estrutura sugerida:</h3>
          <ul>
            <li><strong>Contexto do problema ou tema:</strong> Apresente o cen√°rio que motivou o estudo</li>
            <li><strong>Justificativa para o estudo:</strong> Explique por que o tema √© importante</li>
            <li><strong>Objetivos gerais e espec√≠ficos:</strong> Defina claramente o que se pretende alcan√ßar</li>
            <li><strong>Metodologia utilizada:</strong> Descreva brevemente como o trabalho foi desenvolvido</li>
          </ul>
          
          <h3>Dicas importantes:</h3>
          <ul>
            <li>Seja claro e objetivo</li>
            <li>Use linguagem acad√™mica apropriada</li>
            <li>Mantenha um tom profissional</li>
            <li>Evite informa√ß√µes desnecess√°rias</li>
          </ul>
        `,
        'desenvolvimento': `
          <h3>Como estruturar o Desenvolvimento:</h3>
          <p>Esta √© a parte principal do seu relat√≥rio, onde voc√™ desenvolve o conte√∫do de forma detalhada.</p>
          
          <h3>Se√ß√µes recomendadas:</h3>
          <ul>
            <li><strong>Descri√ß√£o do Contexto/Demanda:</strong> Detalhe as circunst√¢ncias que motivaram o estudo</li>
            <li><strong>Objetivos:</strong> Defina claramente os objetivos gerais e espec√≠ficos</li>
            <li><strong>Possibilidades de Atua√ß√£o:</strong> Explore alternativas e suas implica√ß√µes</li>
            <li><strong>Estudo de Caso:</strong> Apresente exemplos pr√°ticos quando poss√≠vel</li>
          </ul>
          
          <h3>Dicas de escrita:</h3>
          <ul>
            <li>Use linguagem t√©cnica apropriada</li>
            <li>Seja objetivo e direto</li>
            <li>Organize as ideias em par√°grafos l√≥gicos</li>
            <li>Use exemplos para ilustrar conceitos</li>
          </ul>
        `,
        'consideracoes': `
          <h3>Como escrever Considera√ß√µes Finais:</h3>
          <p>Esta se√ß√£o deve sintetizar as principais descobertas e conclus√µes do trabalho.</p>
          
          <h3>Elementos importantes:</h3>
          <ul>
            <li><strong>Principais descobertas:</strong> Destaque os achados mais relevantes</li>
            <li><strong>Limita√ß√µes do estudo:</strong> Seja honesto sobre as limita√ß√µes</li>
            <li><strong>Sugest√µes para trabalhos futuros:</strong> Indique poss√≠veis continuidades</li>
            <li><strong>Impacto e relev√¢ncia:</strong> Explique a import√¢ncia dos resultados</li>
          </ul>
          
          <h3>Dicas para conclus√µes:</h3>
          <ul>
            <li>Seja conciso mas abrangente</li>
            <li>Evite introduzir novos conceitos</li>
            <li>Reconecte com os objetivos iniciais</li>
            <li>Mantenha um tom reflexivo</li>
          </ul>
        `,
        'referencias': `
          <h3>Como formatar Refer√™ncias Bibliogr√°ficas:</h3>
          <p>Liste todas as fontes consultadas seguindo as normas ABNT.</p>
          
          <h3>Formatos principais:</h3>
          <ul>
            <li><strong>Livros:</strong> SOBRENOME, Nome. T√≠tulo da obra. Edi√ß√£o. Local: Editora, ano.</li>
            <li><strong>Artigos:</strong> SOBRENOME, Nome. T√≠tulo do artigo. Nome do Peri√≥dico, local, volume(n√∫mero), p√°ginas, m√™s/ano.</li>
            <li><strong>Teses/Disserta√ß√µes:</strong> SOBRENOME, Nome. T√≠tulo do trabalho. Ano. Disserta√ß√£o (Mestrado) ou Tese (Doutorado) - Institui√ß√£o, local, ano.</li>
          </ul>
          
          <h3>Dicas importantes:</h3>
          <ul>
            <li>Liste apenas as fontes realmente consultadas</li>
            <li>Mantenha ordem alfab√©tica por sobrenome</li>
            <li>Use it√°lico para t√≠tulos de obras</li>
            <li>Verifique a formata√ß√£o ABNT atualizada</li>
          </ul>
        `,
        'simple': `
          <h3>Como usar a Vers√£o Simples:</h3>
          <p>Esta vers√£o permite total liberdade de estrutura√ß√£o do seu relat√≥rio.</p>
          
          <h3>Dicas de estrutura√ß√£o:</h3>
          <ul>
            <li><strong>Comece com uma introdu√ß√£o clara</strong> que apresente o tema</li>
            <li><strong>Desenvolva o tema principal</strong> de forma organizada</li>
            <li><strong>Apresente an√°lises e discuss√µes</strong> sobre o assunto</li>
            <li><strong>Conclua com considera√ß√µes finais</strong> que sintetizem o trabalho</li>
            <li><strong>Inclua refer√™ncias</strong> se necess√°rio</li>
          </ul>
          
          <h3>Ferramentas dispon√≠veis:</h3>
          <ul>
            <li>Use a barra de formata√ß√£o para destacar t√≠tulos</li>
            <li>Crie listas ordenadas e n√£o ordenadas</li>
            <li>Use cita√ß√µes para destacar informa√ß√µes importantes</li>
            <li>Utilize o template para come√ßar com uma estrutura b√°sica</li>
          </ul>
          
          <h3>Dicas de escrita:</h3>
          <ul>
            <li>Organize o texto em par√°grafos bem estruturados</li>
            <li>Use linguagem clara e objetiva</li>
            <li>Mantenha coer√™ncia entre as se√ß√µes</li>
            <li>Revise o texto antes de finalizar</li>
          </ul>
        `
      };
      
      currentHelpContent = helpContents[fieldId] || helpContents['simple'];
    }
    
    // Fun√ß√£o para mudar a fonte
    function changeFont() {
      const selectedFont = document.getElementById('fontFamily').value;
      document.body.classList.remove('font-arial', 'font-times', 'font-helvetica', 'font-georgia', 'font-verdana', 'font-courier');
      document.body.classList.add('font-' + selectedFont);
      
      // Salvar no localStorage
      localStorage.setItem('selectedFont', selectedFont);
    }

    // Melhorar a experi√™ncia de edi√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      const data = document.querySelector('.data');
      const autor = document.querySelector('.autor');
      const professor = document.querySelector('.professor');
      const titulo = document.querySelector('h1[contenteditable="true"]');
      
      const nome_prof = localStorage.getItem('nome_prof');
      if (nome_prof) {
        professor.textContent = 'Professor: ' + nome_prof;
      }
      const nome_aluno = localStorage.getItem('nome_aluno');
      if (nome_aluno) {
        autor.textContent = 'Autor: ' + nome_aluno;
      }
      const titulo_salvo = localStorage.getItem('titulo_relatorio');
      if (titulo_salvo) {
        titulo.textContent = titulo_salvo;
      }
      data.textContent = 'Data: ' + new Date().toLocaleDateString('pt-BR');
      
      // Carregar fonte salva
      const savedFont = localStorage.getItem('selectedFont');
      if (savedFont) {
        document.getElementById('fontFamily').value = savedFont;
        changeFont();
      }
      
      // Salvar dados quando editados
      autor.addEventListener('blur', function() {
        const nome = this.textContent.replace('Autor: ', '').trim();
        if (nome && nome !== 'Nome do Autor') {
          localStorage.setItem('nome_aluno', nome);
        }
      });
      
      professor.addEventListener('blur', function() {
        const nome = this.textContent.replace('Professor: ', '').trim();
        if (nome && nome !== 'Nome do Professor') {
          localStorage.setItem('nome_prof', nome);
        }
      });
      
      // Salvar t√≠tulo quando editado
      titulo.addEventListener('blur', function() {
        const tituloTexto = this.textContent.trim();
        if (tituloTexto && tituloTexto !== 'T√≠tulo do Relat√≥rio') {
          localStorage.setItem('titulo_relatorio', tituloTexto);
        }
      });
      
      titulo.addEventListener('input', function() {
        const tituloTexto = this.textContent.trim();
        if (tituloTexto && tituloTexto !== 'T√≠tulo do Relat√≥rio') {
          localStorage.setItem('titulo_relatorio', tituloTexto);
        }
      });
      
      const editables = document.querySelectorAll('[contenteditable="true"]');
      
      editables.forEach(element => {
        element.addEventListener('focus', function() {
          this.style.borderColor = '#333';
          this.style.background = '#ffffff';
          
          // Limpar conte√∫do inicial se for o texto padr√£o
          if (this.textContent.trim() === 'T√≠tulo do Relat√≥rio' || 
              this.textContent.trim() === 'Autor: Nome do Autor' ||
              this.textContent.trim() === 'Data: dd/mm/aaaa') {
            this.textContent = '';
          }
          
          // Identificar qual campo est√° ativo e definir conte√∫do de ajuda
          let fieldId = 'simple';
          if (this.closest('#introducao')) fieldId = 'introducao';
          else if (this.closest('#desenvolvimento')) fieldId = 'desenvolvimento';
          else if (this.closest('#consideracoes')) fieldId = 'consideracoes';
          else if (this.closest('#referencias')) fieldId = 'referencias';
          else if (this.id === 'simpleContent') fieldId = 'simple';
          
          setHelpContent(fieldId);
        });
        
        element.addEventListener('blur', function() {
          this.style.borderColor = '#ddd';
          this.style.background = '#fafafa';
          
          // Esconder bot√£o de ajuda quando sair do campo
          setTimeout(() => {
            if (!document.querySelector('[contenteditable="true"]:focus')) {
              toggleHelpButton(false);
            }
          }, 100);
        });
        
        // Manter placeholder vis√≠vel quando vazio
        element.addEventListener('input', function() {
          if (this.textContent.trim() === '') {
            this.classList.add('empty');
          } else {
            this.classList.remove('empty');
          }
          
          // Atualizar contadores de palavras
          if (this.id === 'simpleContent') {
            updateWordCount();
          } else if (this.closest('#detailed-version')) {
            updateDetailedWordCounts();
          }
          
          // Mostrar bot√£o de ajuda quando come√ßar a escrever
          if (this.textContent.trim().length > 0) {
            toggleHelpButton(true);
          }
        });
      });
      
      // Navega√ß√£o suave
      document.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            targetElement.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
      
      // Event listeners para a vers√£o simples
      const simpleContent = document.getElementById('simpleContent');
      if (simpleContent) {
        simpleContent.addEventListener('input', updateWordCount);
        simpleContent.addEventListener('keydown', function(e) {
          // Atalhos de teclado
          if (e.ctrlKey) {
            switch(e.key) {
              case 'b':
                e.preventDefault();
                formatText('bold');
                break;
              case 'i':
                e.preventDefault();
                formatText('italic');
                break;
              case 'u':
                e.preventDefault();
                formatText('underline');
                break;
            }
          }
        });
        
        // Atualizar contador inicial
        updateWordCount();
      }
      
      // Inicializar contadores da vers√£o detalhada
      updateDetailedWordCounts();
      
      // Inicializar sistema de tooltips para mobile
      addMobileTooltipEvents();
      
      // Inicializar API Key
      loadApiKeyFromStorage();
      updateApiKeyStatus();
      
      // Event listeners para API Key
      const apiKeyInput = document.getElementById('geminiApiKey');
      if (apiKeyInput) {
        apiKeyInput.addEventListener('input', function() {
          const apiKey = this.value.trim();
          saveGeminiApiKey(apiKey);
        });
        
        apiKeyInput.addEventListener('paste', function() {
          // Pequeno delay para permitir que o paste aconte√ßa primeiro
          setTimeout(() => {
            const apiKey = this.value.trim();
            saveGeminiApiKey(apiKey);
          }, 100);
        });
      }
      
      // Fallback: bot√£o de info do footer
      const footerInfoBtn = document.getElementById('footerInfoBtn');
      if (footerInfoBtn) {
        footerInfoBtn.addEventListener('click', (e) => {
          e.preventDefault();
          showInfoModal();
        });
      }
      
      // Fechar modal quando clicar fora dele
      window.addEventListener('click', function(event) {
        const modal = document.getElementById('helpModal');
        if (event.target === modal) {
          closeHelpModal();
        }
      });
      
      // Fechar modal com tecla ESC
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          closeHelpModal();
        }
      });
      
      // Melhorias para mobile
      function isMobile() {
        return window.innerWidth <= 768;
      }
      
      // Otimizar para dispositivos m√≥veis
      if (isMobile()) {
        // Aumentar √°rea de toque para bot√µes
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.style.minHeight = '44px';
          button.style.minWidth = '44px';
        });
        
        // Melhorar experi√™ncia de digita√ß√£o em mobile
        const editables = document.querySelectorAll('[contenteditable="true"]');
        editables.forEach(element => {
          element.addEventListener('touchstart', function() {
            // Garantir que o teclado virtual apare√ßa
            this.focus();
          });
          
          element.addEventListener('input', function() {
            // Scroll autom√°tico para manter o campo vis√≠vel
            setTimeout(() => {
              this.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
          });
        });
        
        // Melhorar navega√ß√£o em mobile
        const navLinks = document.querySelectorAll('nav a');
        navLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
              // Scroll mais suave em mobile
              targetElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
              
              // Adicionar feedback visual
              this.style.background = 'rgba(255,255,255,0.3)';
              setTimeout(() => {
                this.style.background = '';
              }, 500);
            }
          });
        });
        
        // Otimizar modal para mobile
        const modal = document.getElementById('helpModal');
        if (modal) {
          modal.addEventListener('touchmove', function(e) {
            // Permitir scroll dentro do modal
            e.stopPropagation();
          });
        }
        
        // Melhorar bot√£o de ajuda em mobile
        const helpButton = document.getElementById('helpButton');
        if (helpButton) {
          helpButton.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
          });
          
          helpButton.addEventListener('touchend', function() {
            this.style.transform = '';
          });
        }
        
        // Adicionar feedback t√°til para campos edit√°veis
        editables.forEach(element => {
          element.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
          });
          
          element.addEventListener('touchend', function() {
            this.style.transform = '';
          });
        });
      }
      
      // Detectar mudan√ßa de orienta√ß√£o
      window.addEventListener('orientationchange', function() {
        setTimeout(() => {
          // Reajustar layout ap√≥s mudan√ßa de orienta√ß√£o
          const activeElement = document.querySelector('[contenteditable="true"]:focus');
          if (activeElement) {
            activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }, 500);
      });
    });
    
    // ===== FUN√á√ïES DO MODAL DE IA =====
    
    // Vari√°veis globais para grava√ß√£o de √°udio
    let mediaRecorder = null;
    let audioChunks = [];
    let recordingInterval = null;
    let recordingStartTime = 0;
    let audioBlob = null;
    let isRecording = false;
    let currentTranscription = null; // Armazenar transcri√ß√£o atual
    
    // ===== SISTEMA DE TOOLTIPS =====
    
    // Fun√ß√£o para atualizar tooltip
    function updateTooltip(tooltipId, message, type = 'default') {
      const tooltip = document.getElementById(tooltipId);
      const container = tooltip?.parentElement;
      
      if (tooltip && container) {
        tooltip.textContent = message;
        
        // Remover classes de tipo anteriores
        container.classList.remove('tooltip-success', 'tooltip-error', 'tooltip-warning');
        
        // Adicionar nova classe de tipo
        if (type !== 'default') {
          container.classList.add(`tooltip-${type}`);
        }
      }
    }
    
    // ===== GERENCIAMENTO DA API KEY =====
    
    // Fun√ß√£o para obter a API Key do localStorage
    function getGeminiApiKey() {
      return localStorage.getItem('gemini_api_key') || '';
    }
    
    // Fun√ß√£o para salvar a API Key no localStorage
    function saveGeminiApiKey(apiKey) {
      if (apiKey && apiKey.trim()) {
        localStorage.setItem('gemini_api_key', apiKey.trim());
        updateApiKeyStatus();
        return true;
      }
      return false;
    }
    
    // Fun√ß√£o para validar formato da API Key
    function validateApiKey(apiKey) {
      // Valida√ß√£o b√°sica: deve come√ßar com "AIzaSy" e ter pelo menos 30 caracteres
      if (!apiKey) return false;
      return apiKey.startsWith('AIzaSy') && apiKey.length >= 30;
    }
    
    // Fun√ß√£o para atualizar status da API Key na interface
    function updateApiKeyStatus() {
      const statusElement = document.getElementById('apiKeyStatus');
      const apiKey = getGeminiApiKey();
      
      if (!apiKey) {
        statusElement.innerHTML = '<span class="status-empty"><span class="status-icon">‚ùå</span> Nenhuma chave configurada</span>';
      } else if (validateApiKey(apiKey)) {
        const maskedKey = apiKey.substring(0, 8) + '‚Ä¢'.repeat(apiKey.length - 12) + apiKey.substring(apiKey.length - 4);
        statusElement.innerHTML = `<span class="status-valid"><span class="status-icon">‚úÖ</span> Chave v√°lida: ${maskedKey}</span>`;
      } else {
        statusElement.innerHTML = '<span class="status-invalid"><span class="status-icon">‚ö†Ô∏è</span> Formato de chave inv√°lido</span>';
      }
    }
    
    // Fun√ß√£o para alternar visibilidade da API Key
    function toggleApiKeyVisibility() {
      const input = document.getElementById('geminiApiKey');
      const button = document.getElementById('toggleApiKey');
      
      if (input.type === 'password') {
        input.type = 'text';
        button.textContent = 'üôà';
        button.title = 'Ocultar chave';
      } else {
        input.type = 'password';
        button.textContent = 'üëÅÔ∏è';
        button.title = 'Mostrar chave';
      }
    }
    
    // Fun√ß√£o para limpar API Key
    function clearApiKey() {
      localStorage.removeItem('gemini_api_key');
      document.getElementById('geminiApiKey').value = '';
      updateApiKeyStatus();
    }

    // Fun√ß√£o para fechar o modal de IA
    function closeIAModal() {
      const modal = document.getElementById('modal-ia');
      modal.classList.remove('modal-show');
      
      // Parar grava√ß√£o se estiver ativa
      if (isRecording) {
        stopRecording();
      }
      
      // Limpar transcri√ß√£o
      clearTranscription();
      
      // Resetar formul√°rio
      document.getElementById('textDescription').value = '';
      document.getElementById('reportTopic').value = '';
      
      // Esconder √°rea de √°udio reproduzido
      const audioPlayback = document.getElementById('audioPlayback');
      audioPlayback.style.display = 'none';
      audioPlayback.src = '';
      
      // Resetar bot√£o de reprodu√ß√£o
      document.getElementById('playBtn').disabled = true;
      
      // Limpar dados de √°udio
      audioBlob = null;
      audioChunks = [];
      currentTranscription = null;
      
      // Resetar timer
      document.getElementById('recordingTime').textContent = '00:00';
      
      // Esconder e resetar bot√£o de transcri√ß√£o
      const transcribeBtn = document.getElementById('transcribeBtn');
      transcribeBtn.style.display = 'none';
      transcribeBtn.disabled = true;
      transcribeBtn.setAttribute('aria-label', 'Transcrever √°udio');
      transcribeBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             aria-hidden="true" class="lucide lucide-file-text">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2-2V7.5z"></path>
          <path d="M14 2v6h6"></path>
          <path d="M16 13H8"></path>
          <path d="M16 17H8"></path>
          <path d="M10 9H8"></path>
        </svg>
        <span class="sr-only">Transcrever √Åudio</span>
      `;
      transcribeBtn.style.background = '#28a745';
      
      // Aguardar transi√ß√£o antes de esconder
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    // Inicializar visualizador de √°udio
    function initializeAudioVisualizer() {
      const visualizer = document.getElementById('audioVisualizer');
      visualizer.innerHTML = '';
      
      // Criar barras do visualizador
      for (let i = 0; i < 20; i++) {
        const bar = document.createElement('div');
        bar.className = 'visualizer-bar';
        bar.style.height = '5px';
        visualizer.appendChild(bar);
      }
    }

    // Fun√ß√£o para alternar grava√ß√£o
    async function toggleRecording() {
      if (!isRecording) {
        await startRecording();
      } else {
        stopRecording();
      }
    }

    // Iniciar grava√ß√£o
    async function startRecording() {
      try {
        // Verificar se o navegador suporta getUserMedia
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          throw new Error('Seu navegador n√£o suporta grava√ß√£o de √°udio. Use Chrome, Firefox ou Safari mais recentes.');
        }

        // Verificar permiss√µes primeiro
        try {
          const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
          if (permissionStatus.state === 'denied') {
            throw new Error('Permiss√£o de microfone negada. Permita o acesso ao microfone nas configura√ß√µes do navegador.');
          }
        } catch (permError) {
          console.warn('N√£o foi poss√≠vel verificar permiss√µes:', permError);
          // Continuar mesmo se n√£o conseguir verificar permiss√µes
        }

        // Solicitar acesso ao microfone com configura√ß√µes otimizadas
        const stream = await navigator.mediaDevices.getUserMedia({ 
          audio: {
            echoCancellation: true,
            noiseSuppression: true,
            autoGainControl: true,
            sampleRate: 44100,
            channelCount: 1
          } 
        });
        
        // Verificar se MediaRecorder √© suportado
        if (!window.MediaRecorder) {
          stream.getTracks().forEach(track => track.stop());
          throw new Error('Grava√ß√£o de √°udio n√£o √© suportada neste navegador.');
        }

        // Verificar tipos de m√≠dia suportados
        let mimeType = 'audio/webm';
        if (!MediaRecorder.isTypeSupported('audio/webm')) {
          if (MediaRecorder.isTypeSupported('audio/mp4')) {
            mimeType = 'audio/mp4';
          } else if (MediaRecorder.isTypeSupported('audio/wav')) {
            mimeType = 'audio/wav';
          } else {
            mimeType = ''; // Usar padr√£o do navegador
          }
        }
        
        mediaRecorder = new MediaRecorder(stream, mimeType ? { mimeType } : {});
        
        audioChunks = [];
        isRecording = true;
        recordingStartTime = Date.now();
        
        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            audioChunks.push(event.data);
          }
        };
        
        mediaRecorder.onstop = () => {
          audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType || 'audio/webm' });
          const audioUrl = URL.createObjectURL(audioBlob);
          const audioPlayback = document.getElementById('audioPlayback');
          audioPlayback.src = audioUrl;
          audioPlayback.style.display = 'block';
          
          // Habilitar bot√µes de reprodu√ß√£o e transcri√ß√£o
          document.getElementById('playBtn').disabled = false;
          const transcribeBtn = document.getElementById('transcribeBtn');
          transcribeBtn.disabled = false;
          transcribeBtn.style.display = 'flex';
          
          // Atualizar tooltips
          updateTooltip('playTooltip', 'Reproduzir √°udio gravado', 'success');
          updateTooltip('transcribeTooltip', 'Converter √°udio em texto', 'success');
          
          // Parar todas as tracks do stream
          stream.getTracks().forEach(track => track.stop());
        };
        
        mediaRecorder.onerror = (event) => {
          console.error('Erro do MediaRecorder:', event.error);
          isRecording = false;
          updateRecordingUI(false);
          stream.getTracks().forEach(track => track.stop());
          alert('Erro durante a grava√ß√£o: ' + event.error.message);
        };
        
        mediaRecorder.start(100); // Capturar dados a cada 100ms
        
        // Atualizar UI
        updateRecordingUI(true);
        
        // Iniciar timer
        recordingInterval = setInterval(updateRecordingTime, 100);
        
        // Simular visualiza√ß√£o de √°udio
        startAudioVisualization();
        
        console.log('Grava√ß√£o iniciada com sucesso');
        
      } catch (error) {
        console.error('Erro ao acessar microfone:', error);
        
        // Diferentes tipos de erro com mensagens espec√≠ficas
        let errorMessage = 'Erro ao acessar o microfone: ';
        
        if (error.name === 'NotAllowedError') {
          errorMessage += 'Permiss√£o negada. Clique no √≠cone de microfone na barra de endere√ßos e permita o acesso.';
        } else if (error.name === 'NotFoundError') {
          errorMessage += 'Nenhum microfone encontrado. Verifique se h√° um microfone conectado.';
        } else if (error.name === 'NotSupportedError') {
          errorMessage += 'Grava√ß√£o de √°udio n√£o √© suportada neste navegador.';
        } else if (error.name === 'NotReadableError') {
          errorMessage += 'Microfone est√° sendo usado por outro aplicativo.';
        } else {
          errorMessage += error.message;
        }
        
        alert(errorMessage + '\n\nDica: Use a op√ß√£o de texto se n√£o conseguir gravar √°udio.');
        
        // Garantir que a UI seja restaurada
        isRecording = false;
        updateRecordingUI(false);
      }
    }

    // Parar grava√ß√£o
    function stopRecording() {
      if (mediaRecorder && isRecording) {
        mediaRecorder.stop();
        isRecording = false;
        
        // Parar timer e visualiza√ß√£o
        if (recordingInterval) {
          clearInterval(recordingInterval);
          recordingInterval = null;
        }
        
        stopAudioVisualization();
        updateRecordingUI(false);
      }
    }

    // Atualizar UI da grava√ß√£o
    function updateRecordingUI(recording) {
      const recordBtn = document.getElementById('recordBtn');
      
      if (recording) {
        recordBtn.classList.add('recording');
        recordBtn.setAttribute('aria-label', 'Parar grava√ß√£o');
        
        // Atualizar tooltip
        updateTooltip('recordTooltip', 'Clique para parar grava√ß√£o', 'error');
        
        // Trocar SVG do microfone para √≠cone de parar
        recordBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true" class="lucide lucide-square">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          </svg>
          <span class="sr-only">Parar Grava√ß√£o</span>
        `;
      } else {
        recordBtn.classList.remove('recording');
        recordBtn.setAttribute('aria-label', 'Iniciar grava√ß√£o');
        
        // Atualizar tooltip
        updateTooltip('recordTooltip', 'Clique para iniciar grava√ß√£o', 'default');
        
        // Voltar ao SVG do microfone
        recordBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true" class="lucide lucide-mic">
            <path d="M12 1v11"></path>
            <rect x="8" y="1" width="8" height="14" rx="4"></rect>
            <path d="M19 11a7 7 0 0 1-14 0"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
          <span class="sr-only">Iniciar Grava√ß√£o</span>
        `;
      }
    }

    // Atualizar tempo de grava√ß√£o
    function updateRecordingTime() {
      if (isRecording) {
        const elapsed = Date.now() - recordingStartTime;
        const minutes = Math.floor(elapsed / 60000);
        const seconds = Math.floor((elapsed % 60000) / 1000);
        
        document.getElementById('recordingTime').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }
    }

    // Simular visualiza√ß√£o de √°udio
    function startAudioVisualization() {
      const bars = document.querySelectorAll('.visualizer-bar');
      
      const animate = () => {
        if (isRecording) {
          bars.forEach(bar => {
            const height = Math.random() * 25 + 5; // 5px a 30px
            bar.style.height = height + 'px';
          });
          requestAnimationFrame(animate);
        }
      };
      
      animate();
    }

    // Parar visualiza√ß√£o de √°udio
    function stopAudioVisualization() {
      const bars = document.querySelectorAll('.visualizer-bar');
      bars.forEach(bar => {
        bar.style.height = '5px';
      });
    }

    // Reproduzir √°udio gravado
    function playRecording() {
      const audioPlayback = document.getElementById('audioPlayback');
      if (audioPlayback.src) {
        audioPlayback.play();
      }
    }

    // Fun√ß√£o para transcrever √°udio separadamente
    async function transcribeAudio() {
      if (!audioBlob) {
        alert('Nenhum √°udio dispon√≠vel para transcrever.');
        return;
      }

      const transcribeBtn = document.getElementById('transcribeBtn');
      const originalHTML = transcribeBtn.innerHTML;
      const originalLabel = transcribeBtn.getAttribute('aria-label');
      
      try {
        // Atualizar UI do bot√£o
        transcribeBtn.disabled = true;
        transcribeBtn.classList.add('transcribing');
        transcribeBtn.setAttribute('aria-label', 'Transcrevendo...');
        updateTooltip('transcribeTooltip', 'Processando √°udio...', 'warning');
        transcribeBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true" class="lucide lucide-loader-2">
            <path d="M21 12a9 9 0 11-6.219-8.56"></path>
          </svg>
          <span class="sr-only">Transcrevendo...</span>
        `;
        
        // Limpar transcri√ß√£o anterior se existir
        clearTranscription();
        
        // Converter √°udio para base64
        const base64Audio = await convertAudioToBase64(audioBlob);
        
        // Atualizar texto do bot√£o
        transcribeBtn.setAttribute('aria-label', 'Processando com IA...');
        transcribeBtn.querySelector('.sr-only').textContent = 'Processando com IA...';
        updateTooltip('transcribeTooltip', 'Conectando com IA...', 'warning');
        
        // Transcrever usando Gemini
        const transcription = await transcribeAudioWithGemini(base64Audio, audioBlob.type);
        
        // Armazenar transcri√ß√£o para uso posterior
        currentTranscription = transcription;
        
        // Mostrar transcri√ß√£o na interface
        showTranscription(transcription);
        
        // Atualizar bot√£o para indicar sucesso
        transcribeBtn.setAttribute('aria-label', 'Transcrito com sucesso');
        updateTooltip('transcribeTooltip', 'Transcri√ß√£o conclu√≠da!', 'success');
        transcribeBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true" class="lucide lucide-check">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          <span class="sr-only">Transcrito com Sucesso</span>
        `;
        transcribeBtn.style.background = '#28a745';
        
        console.log('Transcri√ß√£o conclu√≠da:', transcription.substring(0, 100) + '...');
        
      } catch (error) {
        console.error('Erro ao transcrever √°udio:', error);
        
        // Limpar transcri√ß√£o em caso de erro
        currentTranscription = null;
        clearTranscription();
        
        // Mostrar erro no bot√£o
        transcribeBtn.setAttribute('aria-label', 'Erro na transcri√ß√£o');
        transcribeBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
               viewBox="0 0 24 24" fill="none" stroke="currentColor"
               stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
               aria-hidden="true" class="lucide lucide-x">
            <path d="M18 6 6 18"></path>
            <path d="M6 6l12 12"></path>
          </svg>
          <span class="sr-only">Erro na Transcri√ß√£o</span>
        `;
        transcribeBtn.style.background = '#dc3545';
        
        // Mostrar erro para o usu√°rio
        alert('Erro ao transcrever √°udio: ' + error.message + '\n\nTente gravar novamente ou use apenas a descri√ß√£o em texto.');
        
      } finally {
        // Restaurar bot√£o ap√≥s 2 segundos
        setTimeout(() => {
          transcribeBtn.disabled = false;
          transcribeBtn.classList.remove('transcribing');
          transcribeBtn.innerHTML = originalHTML;
          transcribeBtn.setAttribute('aria-label', originalLabel);
          transcribeBtn.style.background = '#28a745';
        }, 2000);
      }
    }

    // Fun√ß√£o principal para gerar relat√≥rio com IA
    async function generateReportWithIA() {
      const generateBtn = document.getElementById('generateBtn');
      const generateProgress = document.getElementById('generateProgress');
      const progressFill = document.querySelector('.progress-fill');
      const progressText = document.getElementById('progressText');
      
      // Validar se h√° conte√∫do para processar
      const textDescription = document.getElementById('textDescription').value.trim();
      const hasAudio = audioBlob !== null;
      
      if (!textDescription && !hasAudio) {
        alert('Por favor, forne√ßa uma descri√ß√£o em texto ou grave um √°udio para gerar o relat√≥rio.');
        return;
      }
      
      // Verificar se a API Key est√° configurada
      const apiKey = getGeminiApiKey();
      if (!apiKey) {
        alert('‚ö†Ô∏è Chave API do Gemini n√£o configurada!\n\nPor favor, configure sua chave API do Gemini nas configura√ß√µes antes de gerar o relat√≥rio.');
        return;
      }
      
      if (!validateApiKey(apiKey)) {
        alert('‚ö†Ô∏è Formato de chave API inv√°lido!\n\nA chave deve come√ßar com "AIzaSy" e ter pelo menos 30 caracteres. Verifique se a chave foi copiada corretamente.');
        return;
      }
      
      // Se h√° √°udio mas n√£o h√° texto, avisar que o √°udio ser√° transcrito
      if (hasAudio && !textDescription) {
        const hasExistingTranscription = currentTranscription !== null;
        const message = hasExistingTranscription 
          ? 'Voc√™ gravou um √°udio que j√° foi transcrito.\n\nDeseja continuar apenas com a transcri√ß√£o do √°udio?'
          : 'Voc√™ gravou um √°udio mas n√£o forneceu descri√ß√£o em texto.\n\nDeseja continuar apenas com a transcri√ß√£o do √°udio?\n\nDica: Para melhores resultados, adicione tamb√©m uma descri√ß√£o em texto.';
        
        const confirmAudio = confirm(message);
        if (!confirmAudio) {
          return;
        }
      }
      
      // Obter configura√ß√µes
      const topic = document.getElementById('reportTopic').value.trim();
      const length = document.getElementById('reportLength').value;
      const academicLevel = document.getElementById('academicLevel').value;
      const style = document.getElementById('reportStyle').value;
      
      try {
        // Atualizar UI para mostrar progresso
        generateBtn.disabled = true;
        generateBtn.classList.add('generating');
        document.getElementById('generateIcon').textContent = '‚è≥';
        document.getElementById('generateText').textContent = 'Gerando...';
        generateProgress.style.display = 'block';
        
        // Processar √°udio se dispon√≠vel
        let audioText = '';
        if (hasAudio) {
          // Verificar se j√° existe transcri√ß√£o
          if (currentTranscription) {
            progressFill.style.width = '40%';
            progressText.textContent = 'Usando transcri√ß√£o existente...';
            audioText = currentTranscription;
            console.log('Usando transcri√ß√£o j√° processada:', audioText.substring(0, 100) + '...');
          } else {
            // Transcrever se ainda n√£o foi feito
            progressFill.style.width = '10%';
            progressText.textContent = 'Convertendo √°udio para base64...';
            
            try {
              progressFill.style.width = '25%';
              progressText.textContent = 'Transcrevendo √°udio com IA...';
              
              audioText = await processAudioWithIA(audioBlob);
              
              // Armazenar transcri√ß√£o para uso futuro
              currentTranscription = audioText;
              
              progressFill.style.width = '40%';
              progressText.textContent = '√Åudio transcrito com sucesso!';
              
              // Mostrar transcri√ß√£o na interface
              showTranscription(audioText);
              
              console.log('Transcri√ß√£o obtida:', audioText.substring(0, 100) + '...');
              
            } catch (error) {
              console.warn('Erro ao processar √°udio:', error);
              progressFill.style.width = '35%';
              progressText.textContent = 'Continuando sem transcri√ß√£o de √°udio...';
              
              // Mostrar aviso mas continuar com texto apenas
              setTimeout(() => {
                if (textDescription) {
                  console.log('Continuando apenas com descri√ß√£o em texto');
                } else {
                  throw new Error('N√£o foi poss√≠vel processar o √°udio e nenhuma descri√ß√£o em texto foi fornecida.');
                }
              }, 1000);
            }
          }
        } else {
          progressFill.style.width = '30%';
          progressText.textContent = 'Preparando gera√ß√£o de conte√∫do...';
        }
        
        // Combinar texto e √°udio
        const combinedInput = [textDescription, audioText].filter(Boolean).join('\n\n');
        
        if (!combinedInput.trim()) {
          throw new Error('Nenhum conte√∫do v√°lido foi fornecido para gerar o relat√≥rio.');
        }
        
        progressFill.style.width = '60%';
        progressText.textContent = 'Gerando conte√∫do com IA...';
        
        // Gerar conte√∫do do relat√≥rio com Gemini
        const generatedContent = await generateContentWithGemini(combinedInput, topic, length, academicLevel, style);
        
        progressFill.style.width = '80%';
        progressText.textContent = 'Estruturando relat√≥rio...';
        
        // Inserir conte√∫do no relat√≥rio
        insertGeneratedContent(generatedContent);
        
        progressFill.style.width = '100%';
        progressText.textContent = 'Conclu√≠do!';
        
        // Aguardar um pouco antes de fechar
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Fechar modal
        closeIAModal();
        
        // Mostrar sucesso
        alert('Relat√≥rio gerado com sucesso usando IA! O conte√∫do foi inserido nos campos apropriados.');
        
      } catch (error) {
        console.error('Erro ao gerar relat√≥rio:', error);
        alert('Erro ao gerar relat√≥rio com IA: ' + error.message + '\nTente novamente ou verifique sua conex√£o.');
      } finally {
        // Restaurar UI
        generateBtn.disabled = false;
        generateBtn.classList.remove('generating');
        document.getElementById('generateIcon').textContent = 'ü§ñ';
        document.getElementById('generateText').textContent = 'Gerar Relat√≥rio com IA';
        generateProgress.style.display = 'none';
        progressFill.style.width = '0%';
      }
    }

    // Processar √°udio com transcri√ß√£o usando Gemini
    async function processAudioWithIA(audioBlob) {
      try {
        // Converter √°udio para base64
        const base64Audio = await convertAudioToBase64(audioBlob);
        
        // Usar Gemini para transcrever o √°udio
        const transcription = await transcribeAudioWithGemini(base64Audio, audioBlob.type);
        
        return transcription;
      } catch (error) {
        console.error('Erro ao processar √°udio:', error);
        throw new Error('N√£o foi poss√≠vel processar o √°udio: ' + error.message);
      }
    }

    // Converter √°udio para base64
    function convertAudioToBase64(audioBlob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function() {
          // Extrair apenas a parte base64 (removendo o prefixo data:...)
          const base64 = reader.result.split(',')[1];
          resolve(base64);
        };
        reader.onerror = function(error) {
          reject(new Error('Erro ao converter √°udio para base64: ' + error));
        };
        reader.readAsDataURL(audioBlob);
      });
    }

    // Transcrever √°udio usando Gemini
    async function transcribeAudioWithGemini(base64Audio, mimeType) {
      const GEMINI_API_KEY = getGeminiApiKey();
      
      if (!GEMINI_API_KEY) {
        throw new Error('Chave API do Gemini n√£o configurada. Configure a chave nas configura√ß√µes.');
      }
      
      const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
      
      // Determinar o tipo MIME correto para o Gemini
      let geminiMimeType = mimeType;
      if (mimeType.includes('webm')) {
        geminiMimeType = 'audio/webm';
      } else if (mimeType.includes('mp4')) {
        geminiMimeType = 'audio/mp4';
      } else if (mimeType.includes('wav')) {
        geminiMimeType = 'audio/wav';
      }

      const requestBody = {
        contents: [
          {
            parts: [
              {
                text: "Por favor, transcreva o √°udio fornecido para texto em portugu√™s. Retorne apenas o texto transcrito, sem coment√°rios adicionais."
              },
              {
                inline_data: {
                  mime_type: geminiMimeType,
                  data: base64Audio
                }
              }
            ]
          }
        ],
        generationConfig: {
          temperature: 0.1,
          topK: 32,
          topP: 1,
          maxOutputTokens: 2048,
        }
      };

      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-goog-api-key': GEMINI_API_KEY
        },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(`Erro na transcri√ß√£o: ${response.status} - ${errorData.error?.message || 'Erro desconhecido'}`);
      }

      const data = await response.json();
      
      
      if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
        throw new Error('Resposta inv√°lida da API de transcri√ß√£o');
      }

      const transcription = data.candidates[0].content.parts[0].text.trim();
      
      if (!transcription || transcription.length < 5) {
        throw new Error('Transcri√ß√£o muito curta ou vazia');
      }

      console.log('Transcri√ß√£o realizada com sucesso:', transcription);
      return transcription;
    }

    // Gerar conte√∫do usando Google Gemini
    async function generateContentWithGemini(userInput, topic, length, academicLevel, style) {
      const GEMINI_API_KEY = getGeminiApiKey();
      
      if (!GEMINI_API_KEY) {
        throw new Error('Chave API do Gemini n√£o configurada. Configure a chave nas configura√ß√µes.');
      }
      
      const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
      
      // Construir prompt detalhado
      const lengthInstructions = {
        'short': 'um relat√≥rio conciso de 2-3 p√°ginas',
        'medium': 'um relat√≥rio de tamanho m√©dio com 4-6 p√°ginas',
        'long': 'um relat√≥rio extenso e detalhado de 7-10 p√°ginas'
      };
      
      const levelInstructions = {
        'ensino-medio': 'linguagem acess√≠vel apropriada para ensino m√©dio',
        'graduacao': 'linguagem acad√™mica de n√≠vel universit√°rio',
        'pos-graduacao': 'linguagem t√©cnica e acad√™mica avan√ßada'
      };
      
      const styleInstructions = {
        'formal': 'estilo formal e acad√™mico',
        'tecnico': 'estilo t√©cnico e objetivo',
        'didatico': 'estilo did√°tico e explicativo'
      };
      
      const currentTopic = topic || 'o tema especificado';
      
      const prompt = `
Voc√™ √© um assistente especializado em cria√ß√£o de relat√≥rios acad√™micos. Com base nas informa√ß√µes fornecidas, crie ${lengthInstructions[length]} sobre ${currentTopic}.

INSTRU√á√ïES ESPEC√çFICAS:
- N√≠vel acad√™mico: ${levelInstructions[academicLevel]}
- Estilo: ${styleInstructions[style]}
- Organize o conte√∫do em se√ß√µes claras
- Use linguagem apropriada para o n√≠vel especificado
- Inclua informa√ß√µes relevantes e bem estruturadas

ENTRADA DO USU√ÅRIO:
${userInput}

FORMATO DE RESPOSTA: Retorne um JSON com a seguinte estrutura exata:
{
  "titulo": "T√≠tulo do Relat√≥rio",
  "introducao": "Texto da introdu√ß√£o...",
  "desenvolvimento": "Texto do desenvolvimento com se√ß√µes...",
  "consideracoes": "Texto das considera√ß√µes finais...",
  "referencias": "Refer√™ncias bibliogr√°ficas formatadas..."
}

IMPORTANTE: 
- Retorne APENAS o JSON v√°lido, sem texto adicional
- Use quebras de linha \\n\\n para separar par√°grafos
- Para destacar subt√≠tulos no desenvolvimento, use **T√≠tulo da Se√ß√£o**
- As refer√™ncias devem seguir formato ABNT b√°sico
- Garanta que o JSON seja v√°lido e parseable
`;

      const requestBody = {
        contents: [
          {
            parts: [
              {
                text: prompt
              }
            ]
          }
        ],
        generationConfig: {
          temperature: 0.7,
          topK: 40,
          topP: 0.95,
          maxOutputTokens: 4096,
        }
      };

      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-goog-api-key': GEMINI_API_KEY
        },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(`Erro da API Gemini: ${response.status} - ${errorData.error?.message || 'Erro desconhecido'}`);
      }

      const data = await response.json();
      
      if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
        throw new Error('Resposta inv√°lida da API Gemini');
      }

      const generatedText = data.candidates[0].content.parts[0].text;
      
      try {
        // Tentar extrair JSON da resposta
        const jsonMatch = generatedText.match(/\{[\s\S]*\}/);
        if (!jsonMatch) {
          throw new Error('JSON n√£o encontrado na resposta');
        }
        
        const parsedContent = JSON.parse(jsonMatch[0]);
        
        // Validar estrutura esperada
        if (!parsedContent.titulo || !parsedContent.introducao || !parsedContent.desenvolvimento) {
          throw new Error('Estrutura de resposta inv√°lida');
        }
        
        return parsedContent;
        
      } catch (parseError) {
        console.error('Erro ao parsear JSON:', parseError);
        console.log('Resposta recebida:', generatedText);
        
        // Fallback: criar estrutura b√°sica com o texto recebido
        return {
          titulo: topic || 'Relat√≥rio Gerado por IA',
          introducao: generatedText.substring(0, 500) + '...',
          desenvolvimento: generatedText,
          consideracoes: 'Considera√ß√µes finais baseadas na an√°lise apresentada.',
          referencias: 'Refer√™ncias ser√£o adicionadas conforme necess√°rio.'
        };
      }
    }

    // Inserir conte√∫do gerado no relat√≥rio
    function insertGeneratedContent(content) {
      // Atualizar t√≠tulo
      const titleElement = document.querySelector('h1[contenteditable="true"]');
      if (titleElement && content.titulo) {
        titleElement.textContent = content.titulo;
        // Salvar t√≠tulo no localStorage
        localStorage.setItem('titulo_relatorio', content.titulo);
      }
      
      // Verificar qual vers√£o est√° ativa
      const reportType = document.getElementById('reportType').value;
      
      if (reportType === 'detailed') {
        // Vers√£o detalhada - inserir em cada se√ß√£o espec√≠fica
        const sections = {
          'introducao': content.introducao,
          'desenvolvimento': content.desenvolvimento,
          'consideracoes': content.consideracoes,
          'referencias': content.referencias
        };
        
        Object.keys(sections).forEach(sectionId => {
          const section = document.getElementById(sectionId);
          if (section && sections[sectionId]) {
            const editable = section.querySelector('.editable');
            if (editable) {
              // Converter texto para HTML com formata√ß√£o
              let htmlContent = sections[sectionId]
                .replace(/\n\n/g, '</p><p>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
              
              // Garantir que comece e termine com tags p
              if (!htmlContent.startsWith('<p>')) {
                htmlContent = '<p>' + htmlContent;
              }
              if (!htmlContent.endsWith('</p>')) {
                htmlContent = htmlContent + '</p>';
              }
              
              editable.innerHTML = htmlContent;
              
              // Limpar placeholder
              editable.classList.remove('empty');
            }
          }
        });
        
        // Atualizar contadores de palavras da vers√£o detalhada
        setTimeout(() => {
          updateDetailedWordCounts();
        }, 100);
        
      } else {
        // Vers√£o simples - inserir tudo no campo √∫nico
        const simpleContent = document.getElementById('simpleContent');
        if (simpleContent) {
          const fullContent = `
            <h3>Introdu√ß√£o</h3>
            <p>${content.introducao}</p>
            
            <h3>Desenvolvimento</h3>
            ${content.desenvolvimento.replace(/\n\n/g, '</p><p>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
            
            <h3>Considera√ß√µes Finais</h3>
            <p>${content.consideracoes}</p>
            
            <h3>Refer√™ncias Bibliogr√°ficas</h3>
            <p>${content.referencias.replace(/\n\n/g, '</p><p>')}</p>
          `;
          simpleContent.innerHTML = fullContent;
          
          // Limpar placeholder
          simpleContent.classList.remove('empty');
          
          // Atualizar contador de palavras da vers√£o simples
          setTimeout(() => {
            updateWordCount();
          }, 100);
        }
      }
    }

    // Event listeners para fechar modal
    window.addEventListener('click', function(event) {
      const modal = document.getElementById('modal-ia');
      if (event.target === modal) {
        closeIAModal();
      }
    });

    // Fechar modal com ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeIAModal();
      }
    });

    // Mostrar transcri√ß√£o na interface
    function showTranscription(transcriptionText) {
      const transcriptionArea = document.getElementById('transcriptionArea');
      const transcriptionTextElement = document.getElementById('transcriptionText');
      
      if (transcriptionText && transcriptionText.trim()) {
        transcriptionTextElement.textContent = transcriptionText;
        transcriptionArea.style.display = 'block';
        
        // Adicionar indicador de que a transcri√ß√£o est√° pronta
        const statusDiv = transcriptionArea.querySelector('.transcription-status');
        if (!statusDiv) {
          const status = document.createElement('div');
          status.className = 'transcription-status';
          status.style.cssText = 'margin-top: 8px; padding: 8px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; font-size: 12px; color: #155724;';
          status.innerHTML = '<strong>‚úÖ Transcri√ß√£o pronta!</strong> Esta transcri√ß√£o ser√° usada na gera√ß√£o do relat√≥rio.';
          transcriptionArea.appendChild(status);
        }
        
        // Rolar para mostrar a transcri√ß√£o
        transcriptionArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else {
        transcriptionArea.style.display = 'none';
      }
    }

    // Limpar transcri√ß√£o quando necess√°rio
    function clearTranscription() {
      const transcriptionArea = document.getElementById('transcriptionArea');
      const transcriptionTextElement = document.getElementById('transcriptionText');
      
      transcriptionTextElement.textContent = '';
      transcriptionArea.style.display = 'none';
    }

    // Fun√ß√£o para mostrar tooltip temporariamente
    function showTooltipTemporarily(tooltipId, message, type = 'default', duration = 2000) {
      const tooltip = document.getElementById(tooltipId);
      const container = tooltip?.parentElement;
      
      if (tooltip && container) {
        const originalMessage = tooltip.textContent;
        const originalClasses = container.className;
        
        updateTooltip(tooltipId, message, type);
        container.classList.add('active');
        
        setTimeout(() => {
          container.classList.remove('active');
          tooltip.textContent = originalMessage;
          container.className = originalClasses;
        }, duration);
      }
    }

    // Eventos para mobile (toque longo para mostrar tooltip)
    function addMobileTooltipEvents() {
      const tooltipContainers = document.querySelectorAll('.tooltip');
      
      tooltipContainers.forEach(container => {
        let touchTimer;
        
        container.addEventListener('touchstart', function(e) {
          touchTimer = setTimeout(() => {
            container.classList.add('active');
          }, 500); // Mostrar tooltip ap√≥s 500ms de toque
        });
        
        container.addEventListener('touchend', function(e) {
          clearTimeout(touchTimer);
          setTimeout(() => {
            container.classList.remove('active');
          }, 2000); // Esconder ap√≥s 2 segundos
        });
        
        container.addEventListener('touchmove', function(e) {
          clearTimeout(touchTimer);
          container.classList.remove('active');
        });
      });
    }

    // Fun√ß√£o para abrir o modal de IA
    function generateReport() {
      const modal = document.getElementById('modal-ia');
      modal.style.display = 'block';
      
      // Aplicar classe para fade/slide in
      setTimeout(() => {
        modal.classList.add('modal-show');
      }, 10);
      
      // Inicializar visualizador de √°udio
      initializeAudioVisualizer();
      
      // Verificar permiss√µes de microfone
      checkMicrophonePermissions();
      
      // Carregar e exibir status da API Key
      loadApiKeyFromStorage();
      updateApiKeyStatus();
    }

    // Verificar permiss√µes de microfone
    async function checkMicrophonePermissions() {
      const recordBtn = document.getElementById('recordBtn');
      const audioNotice = document.querySelector('.audio-notice');
      
      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          updateAudioStatus('unsupported', 'Grava√ß√£o de √°udio n√£o suportada neste navegador');
          return;
        }

        // Verificar permiss√µes
        if (navigator.permissions) {
          try {
            const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
            
            switch (permissionStatus.state) {
              case 'granted':
                updateAudioStatus('ready', 'Microfone dispon√≠vel - clique para gravar');
                break;
              case 'denied':
                updateAudioStatus('denied', 'Permiss√£o de microfone negada - use a op√ß√£o de texto');
                break;
              case 'prompt':
                updateAudioStatus('prompt', 'Clique para gravar - ser√° solicitada permiss√£o');
                break;
            }
            
            // Monitorar mudan√ßas de permiss√£o
            permissionStatus.onchange = () => {
              checkMicrophonePermissions();
            };
            
          } catch (permError) {
            console.warn('N√£o foi poss√≠vel verificar permiss√µes:', permError);
            updateAudioStatus('unknown', 'Clique para testar grava√ß√£o de √°udio');
          }
        } else {
          updateAudioStatus('unknown', 'Clique para testar grava√ß√£o de √°udio');
        }
        
      } catch (error) {
        console.error('Erro ao verificar microfone:', error);
        updateAudioStatus('error', 'Erro ao verificar microfone');
      }
    }

    // Atualizar status do √°udio na UI
    function updateAudioStatus(status, message) {
      const recordBtn = document.getElementById('recordBtn');
      const audioNotice = document.querySelector('.audio-notice');
      
      // Resetar classes
      recordBtn.classList.remove('btn-disabled', 'btn-warning');
      
      switch (status) {
        case 'ready':
          audioNotice.style.background = '#d4edda';
          audioNotice.style.borderColor = '#c3e6cb';
          audioNotice.style.color = '#155724';
          audioNotice.innerHTML = `<strong>‚úÖ Pronto:</strong> ${message}`;
          recordBtn.disabled = false;
          break;
          
        case 'denied':
        case 'unsupported':
          audioNotice.style.background = '#f8d7da';
          audioNotice.style.borderColor = '#f5c6cb';
          audioNotice.style.color = '#721c24';
          audioNotice.innerHTML = `<strong>‚ùå Indispon√≠vel:</strong> ${message}`;
          recordBtn.disabled = true;
          recordBtn.classList.add('btn-disabled');
          break;
          
        case 'prompt':
          audioNotice.style.background = '#cce7ff';
          audioNotice.style.borderColor = '#b3d9ff';
          audioNotice.style.color = '#004085';
          audioNotice.innerHTML = `<strong>üîç Permiss√£o:</strong> ${message}`;
          recordBtn.disabled = false;
          break;
          
        default:
          audioNotice.style.background = '#fff3cd';
          audioNotice.style.borderColor = '#ffeaa7';
          audioNotice.style.color = '#856404';
          audioNotice.innerHTML = `<strong>üí° Dica:</strong> ${message}`;
          recordBtn.disabled = false;
      }
    }

    // Fun√ß√£o para carregar API Key do localStorage
    function loadApiKeyFromStorage() {
      const apiKey = getGeminiApiKey();
      const input = document.getElementById('geminiApiKey');
      if (input && apiKey) {
        input.value = apiKey;
      }
    }
    
    // ===== MODAL DE INFORMA√á√ïES =====
    
    // Fun√ß√£o para mostrar modal de informa√ß√µes
    function showInfoModal() {
      const modal = document.getElementById('infoModal');
      modal.style.display = 'block';
      
      // Adicionar anima√ß√£o de entrada
      setTimeout(() => {
        modal.classList.add('modal-show');
      }, 10);
    }
    
    // Fun√ß√£o para fechar modal de informa√ß√µes
    function closeInfoModal() {
      const modal = document.getElementById('infoModal');
      modal.classList.remove('modal-show');
      
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }
    
    // Fechar modal clicando fora dele
    window.addEventListener('click', function(event) {
      const infoModal = document.getElementById('infoModal');
      if (event.target === infoModal) {
        closeInfoModal();
      }
    });
    
    // Fechar modal com ESC
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const infoModal = document.getElementById('infoModal');
        if (infoModal.style.display === 'block') {
          closeInfoModal();
        }
      }
    });
  </script>
</body>
</html>
